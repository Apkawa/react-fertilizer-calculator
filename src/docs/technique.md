# Алгоритм расчетов

NPK удобрений указывается в процентном отношении оксидов `N`, `P2O5` и `K2O`

Дано:

1. Удобрение 3:11:38
2. Рецепт 200:50:200:170:50

Сначала считается содержание чистых элементов, умножая процент оксида на его `оксид-фактор`

`Оксид-фактор` - характеризует содержание целевого химического элемента в соединении. Выражается в граммах элемента содержащемся в 1 грамме соединения.

Пример расчета для фосфора. (P2O5)

|Элемент | Атомная масса | Количество | Итого |
|--------|---------------|------------|-------|
| P | 30,97 | 2 | 61.94 |
| O | 15,99 | 5 | 79.95 |
| P2O5 |  |  | 141.89 |

```
P = 61.94 / 141.89 = 0.436 ~= 0.44
```
И обратно:
```
P2O5 =  141.89 / 61.94 = 2.29
```

Аналогично и с другими оксидами.

Для упрощения расчетов можно воспользоваться таблицей коэфициентов оксидов:

|      | элемент   |   оксид |
|------|-----------|---------|
| N    | 1         | 1       |
| P2O5 | 0,44      | 2,29    |
| K2O  | 0,83      | 1,2     |
| CaO  | 0,71      | 1,4     |
| MgO  | 0,6       | 1,66    |


Пересчитанный NPK в % чистых элементов
```
3:11:38 => 3*1:11*0.44:38*0.83 => 3:4.84:31.54
```

Рецепт для раствора указывается в мг/литр чистых элементов, без оксидов.

Расчет в калькуляторе ведется перебором от 0 до 15г для каждого из выбранного удобрения.

Допустим, самое оптимальное количество удобрения - 1.5г

```
N = (3% / 100) * 1.5г * 1л = 0.045г/л * 1000 = 45мг/л 
```
Или, упрощенно:
```
N = 3 * 1.5 * 10 = 45.0 мг/л
P = 4.84 * 1.5 * 10 = 72 мг/л
K = 31.54 * 1.5 * 10 = 473.1 мг/л
```

Итого: 1.5г удобрения дадут 45:72:473 потребности в элементах, с превышением калия, нужно подбирать другие комбинации удобрений.


## Расчет NPK удобрения по формуле

Удобрения в калькуляторе хранятся ввиде химической формулы и его процентного содержания:

Дано: удобрение `Нитрат калия`, химическая формула `KNО3`, чистота - 100%.

|Элемент | Атомная масса | Количество | Итого |
|--------|---------------|------------|-------|
| N | 14 | 1 | 14 |
| O | 15,99 | 3 | 47.97 |
| K | 39,09 | 1 | 39,09 |
| KNO3 |  |  | 101,06 |

Итого NPK чистых элементов: 
```
N = (14 / 101.06) * 100% = 13.85 
K = (39.09 / 101.06) * 100% = 38.68
```

Пересчитаем в NPK оксидов:
``` 
N = 13.85*1 ~= 14
P = 0
K = 38.68*1.2 = 46.4
```

Итого: NPK - 14:0:46.4


Алгоритм работает и со смесями, 
вместо 100% используется процентное содержание вещества в смеси, 
NPK элементов  считается для каждого компонента по отдельности и затем суммируется. 
Потом уже переводится в NPK оксидов по коэфициентам из таблицы.

# TDS и ЕС

`TDS (Total Dissolved Solids)` - это суммарный количественный показатель концентрации 
растворенных в воде веществ (солей) или - общее солесодержание. 
Указывается в `ppm`.
Для растворов 1ppm принимается за 1мг/л.

`Электропроводность` - это численное выражение способности водного раствора проводить электрический ток. 
Электрическая проводимость природной воды зависит в основном от степени минерализации и температуры. 
Указывается в `мСм/см`.

TDS - считается как сумма растворенных солей на 1л воды. 
ЕС - в зависимости от коэфициента преобразования - либо равно TDS, либо:

```
EC = (TDS * (1/k)) / 1000
TDS = (EC * k) * 1000
```
Где `k` - коэфициент преобразования прибора. и может быть равен 0.5, 0.7 и 1.0

В калькуляторе считается примерный TDS, в реальности может отличаться и зависеть от качества исходной воды и удобрений.

