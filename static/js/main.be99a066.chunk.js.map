{"version":3,"sources":["components/Calculator/constants/index.ts","calculator/format/hpg.ts","pages/Help/pages.ts","calculator/format/base.ts","utils/index.ts","calculator/helpers.ts","serviceWorker.ts","pages/index.ts","pages/NotFound/index.tsx","themes/index.ts","components/ui/ForkMeOnGitHub.tsx","components/ui/Sidebar/SidebarContainer.tsx","hooks/screen.ts","components/ui/Sidebar/Sidebar.tsx","components/ColorModeToggle.tsx","components/ui/TabMenu/TabMenu.tsx","Root.tsx","calculator/itertools.ts","calculator/index.ts","components/Calculator/saga.ts","components/Calculator/FertilizerManager/saga.ts","saga.ts","redux-helpers/helpers.ts","components/Calculator/constants/fertilizers.ts","components/Calculator/reducers.ts","redux/rootReducers.ts","redux/index.ts","index.tsx","calculator/fertilizer.ts","calculator/constants.ts","components/Calculator/actions.ts","calculator/profile.ts","calculator/molecular-parser/molecularParser.ts","calculator/chem.ts","calculator/dilution.ts","components/Calculator/FertilizerManager/constants.ts","components/Calculator/constants/recipes.ts","calculator/ratio.ts","components/ui/Icon.tsx"],"names":["REDUX_FORM_NAME","STORE_CALCULATE_FORM","CALCULATE_START","CALCULATE_SUCCESS","CALCULATE_ERROR","FERTILIZERS_PUSH","FERTILIZERS_REMOVE","FERTILIZERS_SET","FERTILIZERS_RESET","RECIPE_PUSH","RECIPE_REMOVE","RECIPE_RESET","LOAD_STATE_START","LOAD_STATE_SUCCESS","TOPPING_UP_SUCCESS","FERTILIZERS","HPGFormat","state","parsed","fertilizers","f","els","entries","normalizeFertilizer","id","composition","formula","percent","elements","filter","e","map","npk","elementsToNPK","Object","fromEntries","fInfo","solution_density","solution_concentration","pump_number","parseFloat","match","undefined","push","microNPK","MICRO_ELEMENT_NAMES","chkComplex","buildNPKFertilizer","string","pairs","split","l","k","v","tryParseFloat","solution_volume","V","this","buildFertilizers","FERTILIZER_ELEMENT_NAMES","includes","meta","version","created","ref","calculator","calculationForm","recipe","tAml","normalizeConcentration","dilution_enabled","dilution_volume","dilution_concentration","accuracy","chK2SO4","chMgNO3","mixerOptions","url","addrMixer","result","recipes","profile","trim","pair","length","replace","newNpk","n","p","parseProfileStringToObject","NO3","s","join","NH4","BaseFormat","ext","HELP_PAGES","slug","name","lazy","then","m","default","children","useHelpPagesList","useRouteMatch","path","params","processPages","pages","parentSlug","_slug","active","useHelpPageMap","pageMap","pageMapBuildFunc","_pages","keys","values","sum","reduce","a","b","round","number","precision","Math","pow","Number","EPSILON","countDecimals","value","floor","valueOf","toString","isNaN","toMap","list","field","i","update","item","lookup","newList","updated","updateOrPush","equal","t1","t2","JSON","stringify","getNPKDetailInfo","ratio","getProfileRatioMatrix","ion_balance","calculateIonicBalance","EC","calculateEC","forEach","isFinite","getFillElementsByType","macro","P","K","Ca","Mg","S","Cl","micro","Fe","Mn","B","Zn","Cu","Mo","Co","Si","getEmptyElements","el","calculatePPM","weight","ppmToEC","ppm","calculateToppingUp","options","cSol","currentSolution","nSol","newSolution","toppingVolume","volume","concentration","ECn","W2Ec","profileSaltsConcentration","profileEC","extract_percent","isLocalhost","Boolean","window","location","hostname","registerValidSW","swUrl","config","navigator","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","controller","console","log","onUpdate","onSuccess","catch","error","App","loadable","NotFound","Help","Calculator","ChemFormula","DensityCalculator","Example","presets","require","defaultTheme","polaris","colors","modes","dark","text","card","boxShadow","styles","button","color","shadows","small","large","StyledForkMeOnGithub","styled","span","ForkMeOnGitHub","target","rel","href","StyledOverlay","Flex","docked","pageYOffset","SidebarContainer","props","actions","modalRoot","document","querySelector","createElement","setAttribute","body","appendChild","useSidebarRoot","ReactDOM","createPortal","Helmet","type","onClick","close","backgroundColor","height","width","marginRight","getWindowSize","innerWidth","innerHeight","Sidebar","opened","useState","closed","setClose","windowSize","setWindowSize","useEffect","handleResize","addEventListener","removeEventListener","useWindowSize","setDocked","d","onClose","open","renderCbProps","modal","size","component","Menu","justifyContent","Cross","fontSize","title","ColorModeToggle","useColorMode","colorMode","setColorMode","Icon","Moon","Sun","TabMenu","startPathWith","tabClassName","activeTabClassName","flexDirection","exact","to","HelpPagesSubMenu","help_pages","disabled","isActive","RenderHelpPages","Root","store","theme","padding","margin","flex","sx","marginTop","__VERSION__","__COMMIT_REF_NAME__","__COMMIT_HASH__","__COMMIT_DATE__","combination","iterable","Permutation","getScoreElement","needElements","currentElements","key","curVal","score","calculate_v4","nFertilizers","macroFertilizers","microFertilizers","microNeedElements","microResult","calculate_v3","ignore","MACRO_ELEMENT_NAMES","macroResult","elementsEntries","deltaElements","scores","stats","time","count","Date","getTime","r","calculate_v2","ElementPriority","prevElements","ignoredElements","_priority","fertilizerMap","normalizedFertilizers","weights","base_weight","xElements","calcElements","sort","primaryElement","skipFert","s_k","liquid_weight","elementPrecision","score_el","score_percent","ignored","needElementsLength","totalScore","deltaElementsPairs","dv","loadCalculatorStateSaga","storeCalculateFormSaga","calculateStartSaga","fertilizerPushSaga","fertilizersPushWatcher","loadStateSagaWatcher","calculatorSagaWatcher","calculatorFormChangeWatcher","calculatorRootSaga","action","payload","put","loadStateSuccess","select","getFormValues","formValues","storeCalculateForm","stopSubmit","_error","calculateError","topping_up_enabled","topping_up","toppingUpResult","tRes","toppingUpSuccess","doRecalculate","change","calculateStart","calculateSuccess","newFertilizers","takeLatest","actionTypes","CHANGE","BLUR","ARRAY_PUSH","ARRAY_REMOVE","form","call","all","fork","updateFertilizerForm","fertilizerEditFormChangeWatcher","fertilizerManagerRootSaga","FERTILIZER_EDIT_FORM_NAME","composition_enable","rootSaga","sagas","assertNever","_","defaultFertilizers","initialState","process","DEFAULT_RECIPES","rootReducers","combineReducers","ActionNames","formReducer","composeEnhancers","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","compose","sagaMiddleware","createSagaMiddleware","persistedState","localStorage","getItem","parse","loadPersistedState","middlewares","enhancers","applyMiddleware","createStore","subscribe","setItem","getState","run","render","StrictMode","getElementById","URL","origin","fetch","headers","response","contentType","get","status","indexOf","ready","unregister","reload","checkValidServiceWorker","oxide","NPKOxides","hasOwnProperty","compositionToElements","comp","atomCounts","parseMolecule","massParts","calculateMassParts","atom","mass","subAtoms","parseNitrates","totalSubAtoms","val","skipElements","elementMassPart","fertilizerInfo","convertMass","buildFertilizerFromSolution","_fertsWeights","fertilizer_weights","totalWeight","totalWeightPerElements","f_weight","nf","_el","_el_percent","el_weight","ATOMIC_MASS","fertilizerPush","fertilizerRemove","fertilizerSet","fertilizerReset","recipePush","recipeRemove","recipeReset","loadStateStart","profileCationsAnions","cations","N","anions","cat_an","fixIonicBalanceByS","M_NH4","M_NO3","M_P","M_K","M_Ca","M_Mg","M_S","M_Cl","m_NH4","m_NO3","m_P","m_K","m_Ca","mS","fixIonicBalanceByCa","m_Mg","mCa","convertProfileWithEC","K_KN","K_KMg","K_KCa","K_NH4NO3","r_N","r_NH4","r_NO3","r_K","r_Ca","r_Mg","parseProfileStringToNPK","npkEl","_e","_p","stringifyProfile","findSubgroups","finishingNestedSubgroup","subgroups","currentFormula","currentCount","level","pushSubgroup","parseInt","ch","test","decomposeFormula","elementCounts","elementRe","matcher","singleElementRe","element","_decomposePrimitiveFormula","combinedCounts","subgroup","elementCount","subgroupCounts","nitrates","re","subFormula","c","matchAll","nType","atomMasses","totalMass","dilution_solution","sources","t_con","s_con","groupFertilizerBySolution","groups","A","C","v_1","v_2","Error","DEFAULT_MICRO_RECIPE","ALLOWED_ELEMENT_IN_MATRIX","elMap","El","el2","ppm2","convertProfileWithRatio","newNPK","el1","toEls","_N","elM","getMultiElementRatio","arr","base","min","baseIndex","getMultiRatio","matrix","display","OPTIMAL_RATIO","forwardRef","buttonRef","IconComponent","extraProps","containerSize","setSize","useTheme","current","offsetWidth"],"mappings":"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","file":"static/js/main.be99a066.chunk.js","sourcesContent":["export const REDUX_FORM_NAME = 'calculatorOptions' as const\n\nexport const STORE_CALCULATE_FORM = 'STORE_CALCULATE_FORM'\n\nexport const CALCULATE_START = 'CALCULATE_START' as const;\nexport const CALCULATE_SUCCESS = 'CALCULATE_SUCCESS' as const;\nexport const CALCULATE_ERROR = 'CALCULATE_ERROR'  as const;\n\nexport const FERTILIZERS_PUSH = 'FERTILIZERS_PUSH' as const\nexport const FERTILIZERS_REMOVE = 'FERTILIZERS_REMOVE' as const\nexport const FERTILIZERS_SET = 'FERTILIZERS_SET' as const\nexport const FERTILIZERS_RESET = 'FERTILIZERS_RESET' as const\n\n\nexport const RECIPE_PUSH = 'RECIPE_PUSH' as const\nexport const RECIPE_REMOVE = 'RECIPE_REMOVE' as const\nexport const RECIPE_RESET = 'RECIPE_RESET' as const\n\n\nexport const LOAD_STATE_START = 'LOAD_STATE_START' as const\nexport const LOAD_STATE_SUCCESS = 'LOAD_STATE_SUCCESS' as const\nexport const LOAD_STATE_ERROR = 'LOAD_STATE_ERROR' as const\n\n\nexport const TOPPING_UP_SUCCESS = 'TOPPING_UP_SUCCESS' as const\n","import {BaseFormat} from \"./base\";\nimport {ExportStateType} from \"./types\";\nimport {NPKElements} from \"../types\";\nimport {FERTILIZER_ELEMENT_NAMES, MICRO_ELEMENT_NAMES} from '../constants';\nimport {buildNPKFertilizer, elementsToNPK, normalizeFertilizer} from \"../fertilizer\";\nimport {entries, tryParseFloat} from \"../../utils\";\nimport {FertilizerInfo} from \"../../components/Calculator/types\";\nimport {normalizeConcentration} from \"../dilution\";\n\nconst FERTILIZERS = [\n  \"CaNO3\", \"KNO3\", \"NH4NO3\", \"MgSO4\", \"KH2PO4\", \"K2SO4\", \"MgNO3\", \"CaCl2\",\n]\n\nexport class HPGFormat extends BaseFormat {\n  static ext = \".hpg\"\n\n  export(state: ExportStateType): string {\n    return \"\";\n  }\n\n  buildFertilizers(parsed: any): FertilizerInfo[] {\n    let fertilizers = []\n    for (let f of FERTILIZERS) {\n      let els = entries(normalizeFertilizer(\n        {id: \"\", composition: [{formula: f, percent: 100}]}, true\n      ).elements).filter(e => e[1]).map(e => e[0])\n\n      let npk = elementsToNPK(Object.fromEntries(els.map(e => [e, parsed[`${f}_${e}`] || 0])))\n      const fInfo: FertilizerInfo = {\n        id: f,\n        npk,\n        solution_density: parsed[`gml${f}`] * 1000,\n        solution_concentration: parsed[`gl${f}`],\n      }\n      let pump_number = parseFloat(parsed[`m${f}`].match(/\\d+/)) || undefined\n      if (pump_number) {\n        fInfo.pump_number = pump_number\n      }\n      fertilizers.push(fInfo)\n    }\n    // Micro\n    let microNPK = Object.fromEntries(MICRO_ELEMENT_NAMES.map(e => [e, parsed[`d${e}`]]))\n    if (parsed.chkComplex === \"TRUE\") {\n      const fInfo: FertilizerInfo = buildNPKFertilizer('Микро', microNPK)\n      fInfo.solution_density = parsed['gmlCmplx']\n      fInfo.solution_concentration = parsed['glCmplx']\n      let pump_number = parseFloat(parsed[`mCmplx`].match(/\\d+/))\n      if (pump_number) {\n        fInfo.pump_number = pump_number\n      }\n      fertilizers.push(fInfo)\n    } else {\n      for (let e of MICRO_ELEMENT_NAMES) {\n        if (!microNPK[e]) {\n          continue\n        }\n        const fInfo: FertilizerInfo = buildNPKFertilizer(e, {[e]: microNPK[e] || 0})\n        fInfo.solution_density = parsed[`gl${e}`]\n        fInfo.solution_concentration = parsed[`gl${e}`]\n        let pump_number = parseFloat(parsed[`m${e}`].match(/\\d+/)) || undefined\n        if (pump_number) {\n          fInfo.pump_number = pump_number\n        }\n        fertilizers.push(fInfo)\n      }\n    }\n    return fertilizers\n  }\n\n  import(string: string): ExportStateType {\n    let pairs = string.split('\\n').map(l => l.split('=')).map(([k, v]) => [k, tryParseFloat(v)])\n    let parsed = Object.fromEntries(pairs)\n    const solution_volume = parseFloat(parsed.V || 1)\n    const fertilizers = this.buildFertilizers(parsed)\n    let npk = Object.fromEntries(\n      pairs.filter(e => FERTILIZER_ELEMENT_NAMES.includes(e[0] as FERTILIZER_ELEMENT_NAMES))\n    ) as NPKElements\n    for (let e of MICRO_ELEMENT_NAMES) {\n      let v = npk[e]\n      if (v) {\n        npk[e] = v / 1000\n      }\n    }\n    let state: ExportStateType = {\n      meta: {\n        version: parsed.version || \"\",\n        created: \"\",\n        ref: \"\",\n      },\n      calculator: {\n        calculationForm: {\n          recipe: npk,\n          solution_volume: parsed.tAml / 1000,\n          solution_concentration: normalizeConcentration((solution_volume * 1000) / parsed.tAml),\n          dilution_enabled: true,\n          dilution_volume: solution_volume,\n          dilution_concentration: normalizeConcentration(1),\n          accuracy: 0.01,\n          fertilizers: fertilizers.filter(f => {\n            if (f.id === 'K2SO4') {\n              return parsed.chK2SO4 === 'TRUE'\n            }\n            if (f.id === 'MgNO3') {\n              return parsed.chMgNO3 === 'TRUE'\n            }\n            return true\n          }),\n          mixerOptions: {\n            url: parsed.addrMixer\n          },\n        },\n        result: null,\n        fertilizers,\n        recipes: [],\n      }\n    }\n\n    return state;\n  }\n\n  static parseProfileStringToObject(profile: string): { [key: string]: number } {\n    const elements: { [key: string]: number } = {}\n\n    for (let e of profile.split(' ')) {\n      e = e.trim()\n      if (e) {\n        let pair = e.split('=')\n        if (pair.length === 2) {\n          elements[pair[0].trim()] = parseFloat(pair[1].replace(\",\", '.'))\n        }\n      }\n    }\n    return elements\n  }\n\n  /**\n   * Заполняем 0 пропущенные значения\n   * @param npk\n   */\n  static fillNPKElements(npk: NPKElements): NPKElements {\n    const newNpk = {...npk}\n    for (let n of FERTILIZER_ELEMENT_NAMES) {\n      newNpk[n] = newNpk[n] || 0\n    }\n    return newNpk\n  }\n\n  static parseProfileString(profile: string): NPKElements {\n    const elements: NPKElements = {}\n\n    const p = HPGFormat.parseProfileStringToObject(profile)\n    for (const [k, v] of Object.entries(p)) {\n      if (FERTILIZER_ELEMENT_NAMES.includes(k as FERTILIZER_ELEMENT_NAMES)) {\n        elements[k as FERTILIZER_ELEMENT_NAMES] = v\n      }\n    }\n    if (p['N'] && !elements.NO3) {\n      elements.NO3 = p['N']\n    }\n    return elements\n  }\n\n  static stringifyProfile(npk: NPKElements): string {\n    let s = FERTILIZER_ELEMENT_NAMES.map(\n      e => typeof npk[e] != \"undefined\" && `${e}=${npk[e]}`)\n      .filter(e => e).join(' ')\n    return `N=${(npk.NO3 || 0) + (npk.NH4 || 0)} ${s}`\n  }\n}\n","import {useRouteMatch} from \"react-router-dom\";\n\nexport interface HelpPageType {\n  name: string,\n  slug: string,\n  lazy: () => Promise<string>,\n  active?: boolean,\n  path?: string,\n  children?: HelpPageType[],\n}\n\ninterface RequiredHelpPageType extends Required<HelpPageType> {\n  children: RequiredHelpPageType[]\n}\n\nexport type HelpPageListType = RequiredHelpPageType[]\nexport type HelpPageMapType = {[x: string]: RequiredHelpPageType}\n\nexport const HELP_PAGES: HelpPageType[] = [\n  {\n    slug: 'how_to_use',\n    name: 'Как использовать',\n    lazy: () => import(\"!!raw-loader!../../docs/how_to_use.md\").then(m => m.default)\n  },\n  {\n    slug: 'profile',\n    name: 'Профиль элементов',\n    lazy: () => import(\"!!raw-loader!../../docs/profile/README.md\").then(m => m.default),\n    children: [\n      {\n        slug: 'example',\n        name: 'Примеры профилей',\n        lazy: () => import(\"!!raw-loader!../../docs/profile/example.md\").then(m => m.default)\n      },\n    ]\n  },\n  {\n    slug: 'technique',\n    name: 'Методика расчета',\n    lazy: () => import(\"!!raw-loader!../../docs/technique.md\").then(m => m.default)\n  },\n  {\n    slug: 'chelates',\n    name: 'Изготовление хелатов',\n    lazy: () => import(\"!!raw-loader!../../docs/chelates/README.md\").then(m => m.default)\n  },\n  {\n    slug: 'safety',\n    name: 'Техника безопасности',\n    lazy: () => import(\"!!raw-loader!../../docs/safety/README.md\").then(m => m.default),\n    children: [\n      {\n        slug: 'chem_table',\n        name: 'Таблица опасности веществ',\n        lazy: () => import(\"!!raw-loader!../../docs/safety/chem_table.md\").then(m => m.default),\n      }\n\n    ]\n  },\n  {\n    slug: 'light',\n    name: 'Светокультура',\n    lazy: () => import(\"!!raw-loader!../../docs/light.md\").then(m => m.default)\n  },\n  {\n    slug: 'builds',\n    name: 'Виды установок',\n    lazy: () => import(\"!!raw-loader!../../docs/builds/README.md\").then(m => m.default)\n  },\n  {\n    slug: 'references',\n    name: 'Ссылки и литература',\n    lazy: () => import(\"!!raw-loader!../../docs/references.md\").then(m => m.default)\n  },\n]\n\nexport const HELP_PAGE_MAP: { [x: string]: HelpPageType } = Object.fromEntries(HELP_PAGES.map(p => [p.slug, p]))\n\n\nfunction buildHelpPagesList(slug: string | null): HelpPageListType {\n  const processPages = (pages: HelpPageType[], parentSlug: string): HelpPageListType => {\n    return pages.map(p => {\n      const _slug = [parentSlug, p.slug].filter(p => p).join(\"/\")\n      return {\n        ...p,\n        slug: _slug,\n        children: p.children ? processPages(p.children, _slug) : [],\n        active: _slug === slug,\n        path: '/help/' + _slug,\n      }\n    })\n  }\n  return processPages(HELP_PAGES, '')\n}\n\nexport function useHelpPagesList(): HelpPageListType {\n  const match = useRouteMatch<{ slug: string }>({\n    path: \"/help/:slug*\",\n  });\n  return buildHelpPagesList(match?.params?.slug || null)\n}\n\nexport function useHelpPageMap(): HelpPageMapType  {\n  const pages = useHelpPagesList()\n  const pageMap: HelpPageMapType = {}\n  const pageMapBuildFunc = (_pages: HelpPageListType) => {\n    for (const p of _pages) {\n      pageMap[p.slug] = p\n      if (p.children.length) {\n        pageMapBuildFunc(p.children)\n      }\n    }\n  }\n\n  pageMapBuildFunc(pages)\n  return pageMap\n\n}","import {ExportStateType} from \"./types\";\n\nexport abstract class BaseFormat {\n  static ext: string\n  abstract export(state: ExportStateType): string\n  abstract import(string: string): ExportStateType\n\n\n}\n","export const keys = Object.keys as <T>(o: T) => (Extract<keyof T, string>)[];\nexport const entries = Object.entries as <T>(\n  o: T\n) => [Extract<keyof T, string>, Exclude<T[keyof T], undefined>][]\n\n\nexport const values = Object.values as <T>(\n  o: T\n) => (Exclude<T[keyof T], undefined>)[]\n\nexport function sum(values: number[]) {\n  return values.reduce((a, b) => a + b, 0)\n}\n\nexport function round(number: number, precision: number = 0) {\n  const p = Math.pow(10, precision)\n  return Math.round((number + Number.EPSILON) * p) / p\n}\n\nexport function countDecimals(value: number): number {\n  if (Math.floor(value.valueOf()) === value.valueOf()) return 0;\n  return value.toString().split(\".\")[1].length || 0;\n}\n\nexport function tryParseFloat(value: string): number | string {\n  let v = parseFloat(value)\n  if (!isNaN(v)) {\n    return v\n  }\n  return value\n}\n\ntype ToMapResult<T> = { [K in string]: T }\n\nexport function toMap<T extends object>(list: T[], field: keyof T): ToMapResult<T> {\n  const m: ToMapResult<T> = {}\n  for (let i of list) {\n    let key = i[field] as any as string\n    m[key] = i\n  }\n  return m\n}\n\nexport function update<T extends object>(list: T[], item: T, lookup: keyof T): [T[], boolean] {\n  const newList = [...list]\n  let updated = false\n  for (let i = 0; i < list.length; i++) {\n    if (newList[i][lookup] === item[lookup]) {\n      newList[i] = item\n      updated = true\n      break\n    }\n  }\n  return [newList, updated]\n}\n\nexport function updateOrPush<T extends object>(list: T[], item: T, lookup: keyof T): T[] {\n  const [newList , updated] = update(list, item, lookup)\n  if (!updated) {\n    newList.push(item)\n  }\n  return newList\n}\n\n\nexport function equal(t1: any, t2: any): boolean {\n  return JSON.stringify(t1) === JSON.stringify(t2)\n}\n","import {entries, round, sum} from \"../utils\";\nimport {FertilizerWeights} from './index';\nimport {Elements, MacroElements, MicroElements} from \"./types\";\nimport {calculateEC, calculateIonicBalance} from \"./profile\";\nimport {ElementsMatrixType, getProfileRatioMatrix} from \"./ratio\";\n\nexport interface NPKBalance {\n  ion_balance: number,\n  ratio: ElementsMatrixType,\n  EC: number\n}\n\n\nexport function getNPKDetailInfo(npk: Elements): NPKBalance {\n  const ratio = getProfileRatioMatrix(npk)\n  const result: NPKBalance = {\n    ion_balance: calculateIonicBalance(npk),\n    ratio,\n    EC: calculateEC(npk),\n  }\n  result.EC = calculateEC(npk)\n\n  entries(result).forEach(([k, v]) => {\n    if (k === \"ratio\") {\n      return\n    }\n    v = v as number\n    if (!isFinite(v)) {\n      v = 0\n    }\n    result[k] = round(v, 2)\n  })\n\n  return result\n}\n\nexport function getFillElementsByType<T>(value: T): { macro: MacroElements<T>, micro: MicroElements<T> } {\n  return {\n    macro: {\n      NO3: value, NH4: value, P: value, K: value, Ca: value, Mg: value, S: value, Cl: value,\n    },\n    micro: {\n      Fe: value, Mn: value, B: value, Zn: value, Cu: value, Mo: value, Co: value, Si: value,\n    }\n  }\n\n}\n\nexport function getEmptyElements(): Elements {\n  const el = getFillElementsByType(0)\n  return {\n    ...el.micro,\n    ...el.macro,\n  }\n}\n\n// Считаем PPM раствора\nexport function calculatePPM(\n  fertilizers: FertilizerWeights[],\n  solution_volume = 1,\n): number {\n  return round(sum(fertilizers.map(f => {\n    return f.weight * 1000\n  })) / solution_volume)\n}\n\n// ppm (мг/л) в EC (мСм/см).  k - коэфициент преобразования\nexport function ppmToEC(ppm: number, k: number = 1.0): number {\n  return round(ppm * (1 / k)) / 1000\n}\n\nexport function ECToppm(EC: number, k: number): number {\n  return round((EC * 1000) * k)\n}\n\n\nexport interface CalculateToppingUpOptions {\n  currentSolution: {\n    EC: number,\n    volume: number,\n    profileEC: number,\n    profileSaltsConcentration: number, // г/л\n  }\n  newSolution: {\n    EC: number,\n    volume: number,\n  }\n}\n\nexport interface CalculateToppingUpResult {\n  concentration: number,\n  weight: number,\n  EC: number,\n  volume: number,\n}\n\n// Расчет долива раствора\nexport function calculateToppingUp(options: CalculateToppingUpOptions): CalculateToppingUpResult {\n  const cSol = options.currentSolution;\n  const nSol = options.newSolution;\n\n  const toppingVolume = nSol.volume - cSol.volume\n  if (toppingVolume === 0) {\n    return {\n      weight: 0,\n      concentration: 0,\n      EC: 0,\n      volume: 0\n    }\n  }\n\n  const ECn = -(cSol.EC * cSol.volume - nSol.EC * cSol.volume - nSol.EC * toppingVolume) / toppingVolume\n  const W2Ec = (cSol.profileSaltsConcentration / cSol.profileEC)\n\n  const weight = round(ECn * W2Ec * toppingVolume, 3)\n  const concentration = round((weight / 2) / toppingVolume, 2)\n  return {\n    weight,\n    concentration,\n    EC: round(ECn, 2),\n    volume: toppingVolume\n  }\n}\n\n/**\n *\n * @param value\n * @param percent 0.0 to 1.0\n */\nexport function extract_percent(value: number, percent: number): number {\n  return value - (value / (1 + percent))\n\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/pwa-sw.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import loadable from '@loadable/component';\nimport NotFound from './NotFound'\n\nexport default {\n  App: loadable(() => import('./App')),\n  NotFound,\n  Help: loadable(() => import('./Help')),\n  Calculator: loadable(() => import('./Calculator')),\n  ChemFormula: loadable(() => import('./ChemFormula')),\n  DensityCalculator: loadable(() => import('./DensityCalculator')),\n  Example: loadable(() => import('./Example')),\n}\n","import React from \"react\";\n\nexport default () => <h1>Not found</h1>\n","import {Theme} from \"@/themes/types\";\n\nconst presets: any = require('@theme-ui/presets')\n\nexport const defaultTheme: Theme = {\n  ...presets.polaris,\n  colors: {\n    ...presets.polaris.colors,\n    NO3: '#05AD11',\n    NH4: '#FFF',\n    P: '#DBC403',\n    K: '#E07206',\n    Ca: '#D1C7C7',\n    Mg: '#AB0AE0',\n    S: '#FFF',\n    modes: {\n      dark: {\n        ...presets.polaris.colors.modes.dark,\n        text: \"#9d9d9d\"\n      }\n    },\n  },\n  card: {\n    boxShadow: 'small',\n    p: 2,\n  },\n  styles: {\n    ...presets.polaris.styles,\n    button: {\n      color: 'background'\n    }\n  },\n  shadows: {\n    small: '0 0 4px rgba(0, 0, 0, .125)',\n    large: '0 0 24px rgba(0, 0, 0, .125)'\n  },\n}\nconsole.log(defaultTheme)\n","import React, {FunctionComponent} from \"react\";\nimport styled from \"styled-components\";\n\n\nconst StyledForkMeOnGithub = styled.span`\n&>a {\n    background: #000;\n    color: #fff;\n    text-decoration: none;\n    font-family: arial, sans-serif;\n    text-align: center;\n    font-weight: bold;\n    padding: 5px 40px;\n    font-size: 1rem;\n    line-height: 2rem;\n    position: relative;\n    transition: 0.5s;\n}\n\n&>a:hover {\n    background: #c11;\n    color: #fff;\n}\n\n&>a::before, &>a::after {\n    content: \"\";\n    width: 100%;\n    display: block;\n    position: absolute;\n    top: 1px;\n    left: 0;\n    height: 1px;\n    background: #fff;\n}\n\n&>a::after {\n    bottom: 1px;\n    top: auto;\n}\n\n@media screen and (min-width: 800px) {\n    & {\n        position: absolute;\n        display: block;\n        top: 0;\n        right: 0;\n        width: 200px;\n        overflow: hidden;\n        height: 200px;\n        z-index: 100;\n    }\n\n    &>a {\n        // width: 200px;\n        position: absolute;\n        top: 40px;\n        right: -50px;\n        transform: rotate(45deg);\n        box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.8);\n    }\n}\n`\n\ninterface ForkMeOnGitHubProps {\n}\n\nexport const ForkMeOnGitHub: FunctionComponent<ForkMeOnGitHubProps> = () => {\n  return (\n    <StyledForkMeOnGithub>\n      <a\n        target=\"_blank\"\n        rel=\"noopener noreferrer\"\n        href={'https://github.com/Apkawa/react-fertilizer-calculator'}\n      >Fork me on GitHub</a>\n    </StyledForkMeOnGithub>\n  )\n}\n","import React, {ReactNode} from \"react\";\nimport ReactDOM from 'react-dom'\nimport {Card, Flex} from \"rebass\";\nimport styled from '@emotion/styled'\nimport {Helmet} from \"react-helmet\";\nimport {SidebarActions} from \"@/components/ui/Sidebar/Sidebar\";\n\n\ninterface SidebarContainerProps {\n  actions: SidebarActions,\n  children: ReactNode,\n  docked?: boolean,\n}\n\nconst useSidebarRoot = () => {\n  let el = document.querySelector('#sidebar-root')\n  if (!el) {\n    el = document.createElement('div')\n    el.setAttribute('id', 'sidebar-root')\n    document.body.appendChild(el)\n  }\n  return el\n}\n\ninterface OverlayProps  {\n  docked?: boolean\n}\n\nconst StyledOverlay = styled(Flex)<OverlayProps>`\n  overflow-y: auto;\n  position: absolute;\n  height: 100%;\n  top: 0;\n  left: 0;\n  justify-content: left;\n  align-items: stretch;\n  z-index: 999;\n  width: fit-content;\n  \n  //// Mobile\n  //@media screen and (max-height: 500px), screen and (max-width: 500px) {\n  //  align-items: initial;\n  //}\n  ${({docked}) => (docked? `` : `\n    top: ${() => `${window.pageYOffset}px`};\n    width: 100%;\n    background-color: rgba(255, 255, 255, 0.5);\n  `)}\n`\n\nexport function SidebarContainer(props: SidebarContainerProps) {\n  const {\n    children,\n    actions,\n    docked\n  } = props\n  const modalRoot = useSidebarRoot()\n\n  const onClickOverlay = () => {\n    if (!docked) {\n      actions.close()\n    }\n  }\n  return ReactDOM.createPortal(\n    <>\n      <Helmet>\n        <style type='text/css'>\n          {!docked && `\n          body {\n            overflow: hidden;\n          }\n        `}\n        </style>\n      </Helmet>\n      <StyledOverlay\n        docked={docked}\n        onClick={onClickOverlay}\n      >\n        <Card backgroundColor='#fff' height=\"100vh\" width=\"300px\" marginRight={2}>\n          {children}\n        </Card>\n      </StyledOverlay>\n    </>\n    , modalRoot)\n}\n","import { useState, useEffect } from 'react';\n\ninterface Size {\n  width: number,\n  height: number,\n}\n\n\nfunction getWindowSize() : Size {\n  return {\n    width: window.innerWidth,\n    height: window.innerHeight,\n  }\n}\n\n// Hook\nexport function useWindowSize() {\n  // Initialize state with undefined width/height so server and client renders match\n  // Learn more here: https://joshwcomeau.com/react/the-perils-of-rehydration/\n  const [windowSize, setWindowSize] = useState<Size>(getWindowSize());\n\n  useEffect(() => {\n    // Handler to call on window resize\n    function handleResize() {\n      // Set window width/height to state\n      setWindowSize(getWindowSize);\n    }\n\n    // Add event listener\n    window.addEventListener(\"resize\", handleResize);\n\n    // Call handler right away so state gets updated with initial window size\n    handleResize();\n\n    // Remove event listener on cleanup\n    return () => window.removeEventListener(\"resize\", handleResize);\n  }, []); // Empty array ensures that effect is only run on mount\n\n  return windowSize;\n}\n","import React, {ReactNode, useEffect, useState} from \"react\";\nimport {Box, Flex, Heading} from \"rebass\";\nimport {Icon} from \"@/components/ui/Icon\";\nimport {Menu} from \"@styled-icons/boxicons-regular/Menu\"\nimport {Cross} from \"@styled-icons/entypo/Cross\";\nimport {SidebarContainer} from \"@/components/ui/Sidebar/SidebarContainer\";\nimport {useWindowSize} from \"@/hooks/screen\";\n\nexport interface SidebarActions {\n  open: () => void,\n  close: () => void,\n}\n\ntype RenderCb = (props: { modal: SidebarActions }) => ReactNode\n\ninterface SidebarProps {\n  opened?: boolean,\n  onClose?: () => void,\n  button?: RenderCb,\n  title?: string,\n  children: ReactNode,\n  docked?: boolean,\n}\n\n\nexport function Sidebar(props: SidebarProps) {\n  const {\n    opened = Boolean(props.docked),\n    button,\n  } = props\n\n  const [closed, setClose] = useState(!opened)\n  const windowSize = useWindowSize()\n\n  const [docked, setDocked] = useState(props.docked || windowSize.width > 1024)\n\n\n  useEffect(() => {\n    const d = props.docked || windowSize.width > 1650\n    setDocked(d)\n    if (d && closed) {\n      setClose(false)\n    }\n  }, [windowSize, closed, props.docked])\n\n  useEffect(() => {\n    setClose(!opened)\n  }, [opened])\n\n  useEffect(() => {\n    if (closed && props.onClose) {\n      props.onClose()\n    }\n  }, [closed, props])\n\n  const actions: SidebarActions = {\n    open: () => setClose(false),\n    close: () => setClose(true),\n  }\n  const renderCbProps = {modal: actions}\n\n  return (\n    <>\n      {button ? button(renderCbProps) : (\n        <Icon\n          size={42}\n          component={Menu}\n          onClick={actions.open}\n        />\n      )}\n      {closed ? null :\n        <SidebarContainer actions={actions} docked={docked}>\n          <Flex justifyContent='space-between'>\n            {docked ? null : <Icon size={42} component={Cross} onClick={actions.close}/>}\n            <Heading fontSize={2}>{props.title}</Heading>\n          </Flex>\n          <Box>\n            {props.children}\n          </Box>\n        </SidebarContainer>\n      }\n    </>\n  )\n}\n\n","import React, {FunctionComponent} from \"react\";\nimport {useColorMode} from \"theme-ui\";\nimport {Moon} from \"@styled-icons/boxicons-solid/Moon\"\nimport {Sun} from \"@styled-icons/fa-solid/Sun\"\n\ninterface ColorModeProps {\n}\n\nexport const ColorModeToggle: FunctionComponent<ColorModeProps> = () => {\n    const [colorMode, setColorMode] = useColorMode()\n    const Icon = colorMode === 'default'? Moon : Sun\n    return (\n          <Icon\n            onClick={() => {\n              setColorMode(colorMode === 'default' ? 'dark' : 'default')\n            }}\n            size={42}\n            color={\"text\"}\n          />\n    )\n}\n","import React from \"react\";\nimport {NavTab, RoutedTabs} from \"react-router-tabs\";\n\nimport {Flex} from \"rebass\";\nimport {Sidebar} from \"@/components/ui/Sidebar/Sidebar\";\nimport {ColorModeToggle} from \"@/components/ColorModeToggle\";\n\nimport \"./style.css\"\nimport {HelpPageListType, useHelpPagesList} from \"@/pages/Help/pages\";\nimport {useRouteMatch} from \"react-router-dom\";\n\ninterface TabMenuProps {\n}\n\n\nexport function TabMenu(props: TabMenuProps) {\n  return (\n    <Sidebar>\n      <RoutedTabs\n        startPathWith={''}\n        tabClassName=\"tab-link\"\n        activeTabClassName=\"active\"\n      >\n        <Flex flexDirection=\"column\">\n          <NavTab exact to=\"/\">Калькулятор</NavTab>\n          <NavTab to=\"/fertilizers\">Удобрения</NavTab>\n          <NavTab to=\"/formula/\">Парсер формул</NavTab>\n          <NavTab to=\"/density/\">Плотность</NavTab>\n          <HelpPagesSubMenu />\n        </Flex>\n      </RoutedTabs>\n      <ColorModeToggle/>\n    </Sidebar>\n  )\n}\n\nexport function RenderHelpPages(help_pages: HelpPageListType) {\n\n  return (<ul>\n    {help_pages.map(p => (\n      <>\n        <li>\n          <NavTab to={p.path} exact>{p.name}</NavTab>\n          {p.children.length? RenderHelpPages(p.children): null}\n        </li>\n      </>\n    ))}\n  </ul>\n  )\n\n}\n\nexport function HelpPagesSubMenu(props: {}) {\n  const match = useRouteMatch<{ slug: string }>({\n    path: \"/help/:slug?\",\n  });\n  const help_pages = useHelpPagesList()\n  return (\n    <>\n      <NavTab disabled to={\"\"} isActive={() => !!match}>Справка</NavTab>\n      {RenderHelpPages(help_pages)}\n    </>\n  )\n}\n","import React, {FunctionComponent} from 'react'\nimport {Provider} from 'react-redux'\nimport {HashRouter as Router, Route, Switch} from 'react-router-dom'\n\n\nimport {ThemeProvider} from 'theme-ui'\n\n\nimport pages from './pages'\nimport {Box, Flex, Text} from \"rebass\";\nimport {defaultTheme} from \"./themes\";\nimport {ForkMeOnGitHub} from \"./components/ui/ForkMeOnGitHub\";\nimport {TabMenu} from \"@/components/ui/TabMenu/TabMenu\";\n\n\ntype RootProps = {\n  store: any\n}\n\nconst Root: FunctionComponent<RootProps> = ({store}) => {\n  return (\n    <Provider store={store}>\n      <ThemeProvider theme={defaultTheme}>\n        <Router>\n          <Flex justifyContent=\"space-between\">\n            <Box\n              padding={1}\n            >\n              <TabMenu/>\n            </Box>\n            <ForkMeOnGitHub/>\n          </Flex>\n          <Flex flexDirection='column' margin={2}>\n            <Box flex={1}>\n              <Flex sx={\n                {\n                  justifyContent: 'center'\n                }\n              }>\n                <Box width='936px'>\n                  <Switch>\n                    <Route path={\n                      [\n                        \"/formula/:formula?/:percent?\",\n                      ]} component={pages.ChemFormula}/>\n                    <Route path={\n                      [\n                        \"/density/:formula?/:concentration?/:density?/\",\n                      ]} component={pages.DensityCalculator}/>\n                    <Route path=\"/example\" component={pages.Example}/>\n                    <Route path=\"/help/:slug*\"  component={pages.Help}/>\n                    <Route path=\"/\" component={pages.Calculator}/>\n                    <Route path=\"*\" component={pages.NotFound}/>\n                  </Switch>\n                </Box>\n              </Flex>\n            </Box>\n            <Flex justifyContent={\"flex-end\"} marginTop=\"auto\" flex={1}>\n              <Text fontSize={1}>\n                {__VERSION__}-{__COMMIT_REF_NAME__} {__COMMIT_HASH__} [{__COMMIT_DATE__}]\n              </Text>\n            </Flex>\n          </Flex>\n        </Router>\n      </ThemeProvider>\n    </Provider>\n  )\n}\n\nexport default Root\n","import {Permutation} from \"js-combinatorics\";\n\ntype GenericIterableIterator<T> = IterableIterator<{\n  [K in keyof T]: T[K] extends Iterable<infer U> ? U : never\n}>\n\nexport function* combination<T extends Array<any>>(iterable: T): GenericIterableIterator<T> {\n  for (let p of new Permutation(iterable)) {\n    yield p as any\n  }\n}\n\n// NB: throws if any iterables passed to it are empty\n// via https://gist.github.com/cybercase/db7dde901d7070c98c48#gistcomment-3033459\nexport function* product<T extends Array<Iterable<any>>>(...iterables: T): GenericIterableIterator<T> {\n  if (iterables.length === 0) {\n    return;\n  }\n  // make a list of iterators from the iterables\n  const iterators = iterables.map(it => it[Symbol.iterator]());\n  const results = iterators.map(it => it.next());\n  if (results.some(r => r.done)) {\n    throw new Error(\"Input contains an empty iterator.\");\n  }\n\n  for (let i = 0; ;) {\n    if (results[i].done) {\n      // reset the current iterator\n      iterators[i] = iterables[i][Symbol.iterator]();\n      results[i] = iterators[i].next();\n      // advance, and exit if we've reached the end\n      if (++i >= iterators.length) {\n        return;\n      }\n    } else {\n      yield results.map(({value}) => value) as any;\n      i = 0;\n    }\n    results[i] = iterators[i].next();\n  }\n}\n\n\n","import {combination, product} from \"./itertools\";\nimport {countDecimals, entries, keys, round, sum, values} from \"../utils\";\nimport {FERTILIZER_ELEMENT_NAMES, MACRO_ELEMENT_NAMES, MICRO_ELEMENT_NAMES} from \"./constants\";\nimport {Elements, Fertilizer, FertilizerInfo, NeedElements} from \"./types\";\nimport {getEmptyElements, getFillElementsByType} from \"./helpers\";\nimport {normalizeFertilizer} from \"./fertilizer\";\nimport {Concentration, normalizeConcentration} from \"./dilution\";\n\n\nexport interface FertilizerWeights {\n  id: string,\n  // г/л\n  weight: number\n  // TODO удалить\n  base_weight: number,\n  // Если удобрение в жидком виде, в мл\n  volume?: number | null,\n  // Если задана плотность\n  liquid_weight?: number | null,\n}\n\nexport interface CalculateResult {\n  fertilizers: FertilizerWeights[],\n  elements: Elements,\n  deltaElements: Elements,\n  score: number,\n  stats: {\n    time: number,\n    count: number,\n  },\n}\n\nexport type IgnoreElements = {\n  [E in keyof Elements]?: boolean\n}\n\nexport interface CalculateOptions {\n  accuracy?: number,\n  max_iterations?: number,\n  ignore?: IgnoreElements,\n  solution_volume?: number,\n  solution_concentration?: Concentration|number,\n  // Необходимо для расчета с использованием предыдущих данных,\n  // например, после расчета микроэлементов добавляются макроэлементы и надо их как то учитывать и наоборот\n  prevElements?: Elements,\n}\n\nexport function sumFertilizers(fertilizers: Fertilizer[], portions: number[]): Elements {\n  const pairs = FERTILIZER_ELEMENT_NAMES.map(key =>\n    [\n      key,\n      sum(\n        portions.map(\n          (weight, index) => weight * fertilizers[index].elements[key])\n      )\n    ]\n  )\n  return Object.fromEntries(pairs)\n}\n\n\nexport function getScoreElement(needElements: NeedElements, currentElements: Elements): Elements {\n  let pairs = entries(needElements).map(([key, value]) => {\n    let curVal = currentElements[key]\n    let score = 100\n    if (curVal !== 0) {\n      if (curVal < value) {\n        score = value / curVal;\n      } else {\n        score = curVal / value\n      }\n    } else {\n      if (curVal === value) {\n        // В рецепте тоже ноль\n        score = 1.0\n      }\n    }\n    return [key, score]\n  })\n  return Object.fromEntries(pairs)\n}\n\n// Оптимизация подбора путем разделения удобрений на макро и микро\nexport function calculate_v4(\n  needElements: NeedElements,\n  fertilizers: FertilizerInfo[],\n  options: CalculateOptions = {}\n): CalculateResult {\n  let nFertilizers = Object.fromEntries(fertilizers.map(f => [f.id, normalizeFertilizer(f)]))\n  let macroFertilizers = fertilizers.filter(f => !MICRO_ELEMENT_NAMES.filter(n => nFertilizers[f.id].elements[n]).length)\n  let microFertilizers = fertilizers.filter(f => MICRO_ELEMENT_NAMES.filter(n => nFertilizers[f.id].elements[n]).length)\n\n  const microNeedElements = Object.fromEntries(entries(needElements)\n    .filter(([el, v]) =>\n      // Если какой то микро равен нулю - это значит что его не указали и его игнорируем\n      MICRO_ELEMENT_NAMES.includes(el as MICRO_ELEMENT_NAMES) && v > 0)\n  ) as NeedElements\n  let microResult = calculate_v3(microNeedElements, microFertilizers,\n    {...options, ignore: {...options.ignore, ...getFillElementsByType(true).macro}})\n\n  MACRO_ELEMENT_NAMES.forEach(e => {\n    needElements[e] = needElements?.[e] || 0 - microResult.elements[e]\n  })\n\n  let macroResult = calculate_v3(needElements, macroFertilizers,\n    {...options, ignore: {...options.ignore, ...getFillElementsByType(true).micro}})\n\n\n  let elementsEntries = entries(macroResult.elements).map(([e, v]) => [e, v + microResult.elements[e]])\n  let elements = Object.fromEntries(elementsEntries)\n  let deltaElements = FERTILIZER_ELEMENT_NAMES.map((e) => [e, (needElements[e]||0) - elements[e]])\n\n  let scores = []\n  if (macroFertilizers.length > 0) {\n    scores.push(macroResult.score)\n  }\n  if (microFertilizers.length > 0) {\n    scores.push(microResult.score)\n  }\n\n  let result: CalculateResult = {\n    fertilizers: [\n      ...macroResult.fertilizers,\n      ...microResult.fertilizers\n    ],\n    elements,\n    deltaElements: Object.fromEntries(deltaElements),\n    score: round(sum(scores) / scores.length,1),\n    stats: {\n      time: round(macroResult.stats.time + microResult.stats.time, 3),\n      count: macroResult.stats.count + microResult.stats.count,\n    }\n\n  }\n\n  return result\n}\n\n// Подбор оптимального количества путем пересортировки удобрений\nexport function calculate_v3(\n  needElements: NeedElements,\n  fertilizers: FertilizerInfo[],\n  options: CalculateOptions = {}\n): CalculateResult {\n\n  let result: CalculateResult | null = null\n  const time = new Date().getTime();\n  let count = 0;\n  for (let f of combination(fertilizers)) {\n    if (count > 3000) {\n      // Решение скорее всего не существует, таймаут\n      break\n    }\n    const r = calculate_v2(needElements, f, options)\n    if (!result) {\n      result = r\n      continue\n    }\n    if (result.score >= 100) {\n      break\n    }\n    if (result.score < r.score) {\n      result = r\n    }\n    count += 1\n  }\n  if (result) {\n    result.stats.count = count\n    result.stats.time = (new Date().getTime() - time) / 1000\n  }\n  return result as CalculateResult\n\n}\n\nconst ElementPriority: Partial<NeedElements> = {\n  'NH4': 2000,\n  'P': 2000,\n  // Комплекс по бору\n  'B': 5000,\n}\n\n// Алгоритм расчетов из https://github.com/siv237/HPG\nexport function calculate_v2(\n  needElements: NeedElements,\n  fertilizers: FertilizerInfo[],\n  options: CalculateOptions = {}\n): CalculateResult {\n  const {\n    accuracy = 0.1,\n    ignore = {},\n    solution_volume = 1,\n    solution_concentration = 1,\n    prevElements = getEmptyElements(),\n  } = options || {}\n  const precision = countDecimals(accuracy)\n  let ignoredElements: Elements = getEmptyElements()\n  let _priority = {\n    ...getFillElementsByType(1000).macro,\n    ...getFillElementsByType(3000).micro,\n    ...ElementPriority\n  }\n  for (let key of keys(ignoredElements)) {\n    if (ignore[key]) {\n      ignoredElements[key] = 1\n    }\n    if (typeof needElements[key] == \"undefined\") {\n      ignoredElements[key] = 1\n    }\n    // Понижаем приоритет если игнорируется\n    if (_priority?.[key] && ignoredElements[key]) {\n      _priority[key] = (_priority[key] || 0) - 1000\n    }\n  }\n\n\n  const fertilizerMap = Object.fromEntries(fertilizers.map(f => [f.id, f]))\n  const normalizedFertilizers = fertilizers.map(f => normalizeFertilizer(f));\n  let weights: { [K: string]: FertilizerWeights } = Object.fromEntries(\n    fertilizers.map(v => ([v.id, {\n      id: v.id,\n      weight: 0,\n      base_weight: 0,\n      volume: null,\n    }])))\n  const xElements = {...needElements}\n  const calcElements = prevElements;\n\n  for (let f of normalizedFertilizers) {\n    let p = entries(f.elements)\n      // Удаляем нулевой вес\n      .filter(v => v[1])\n      .sort((a, b) => {\n          let cmp1 = ((_priority?.[b[0]] || 0) - (_priority?.[a[0]] || 0))\n          let cmp2 = (\n            ((xElements[a[0]] || 0) / a[1] - (xElements[b[0]] || 0) / b[1])\n          )\n          return cmp1 + cmp2\n        }\n      )\n\n    let primaryElement = p.filter(([a]) => (xElements[a] || 0) > 0 && (needElements[a] || 0) > 0)?.[0]?.[0]\n    // Стараемся принять во внимание комплексные удобрения вроде акварина\n    let skipFert = p.filter(([a]) => (needElements[a] || 0) <= 0 && !ignoredElements[a]).length === 1\n    if (!primaryElement || skipFert) {\n      continue\n    }\n\n    let m = Object.fromEntries(p)\n    let weight = (xElements[primaryElement] || 0) / (m[primaryElement] * 10)\n    let fInfo = fertilizerMap[f.id]\n    weights[f.id].base_weight = round(weight, 4)\n    const s_k = normalizeConcentration(solution_concentration)\n    weights[f.id].weight = round(weight * solution_volume * s_k.k, precision)\n    if (fInfo.solution_concentration) {\n      weights[f.id].volume = round((weights[f.id].weight * 1000) / fInfo.solution_concentration, precision)\n    }\n    let volume = weights[f.id].volume\n    if (fInfo.solution_density && volume) {\n      weights[f.id].liquid_weight = round(volume * (fInfo.solution_density / 1000), precision)\n    }\n\n    for (let [a, v] of p) {\n      const e = weight * v * 10\n      // Плавающая точность. повышаем точность в случае микроэлементов, при выводе домножить до 1000\n      let elementPrecision = countDecimals(needElements[a] || 0)\n      if (MICRO_ELEMENT_NAMES.includes(a as MICRO_ELEMENT_NAMES)) {\n        // Принудительно повышаем точность для микроэлементов\n        elementPrecision = 4\n      }\n      calcElements[a] += round(e, elementPrecision)\n      xElements[a] = (xElements[a] || 0) - e\n    }\n  }\n  let score_el: Elements = getScoreElement(needElements, calcElements)\n  for (let [e, v] of entries(ignoredElements)) {\n    if (v) {\n      score_el[e] = 0\n    }\n  }\n  const score_percent = sum(Object.values(score_el))\n\n  let ignored = sum(values(ignoredElements));\n  const needElementsLength = keys(ignoredElements).length\n  const totalScore = round(100 / ((score_percent - (needElementsLength - ignored)) / (needElementsLength - ignored) + 1), 2)\n\n  const deltaElementsPairs = entries(calcElements).map(([k, v]) => {\n    let dv = round((needElements[k] || 0) - v || 0, 1)\n    if (!dv) {\n      // удаляем знак у нуля\n      dv = 0\n    }\n    return [k, dv]\n  })\n  const deltaElements = Object.fromEntries(deltaElementsPairs)\n\n  return {\n    fertilizers: values(weights)\n      .map(v => ({\n        ...v,\n        base_weight: round(v.base_weight, precision),\n        weight: round(v.weight, precision),\n      }))\n      .filter(v => v.weight),\n    elements: calcElements,\n    deltaElements,\n    score: totalScore || 0,\n    stats: {\n      count: 0,\n      time: 0,\n    }\n  }\n\n\n}\n\n// DEPRECATED\nexport function calculate_v1(\n  needElements: NeedElements,\n  fertilizers: Fertilizer[],\n  options: CalculateOptions = {},\n): CalculateResult {\n\n  const time = new Date().getTime();\n  let count = 0;\n  const {\n    accuracy = 0.1,\n    max_iterations = 25,\n    ignore = {},\n  } = options || {}\n  const precision = countDecimals(accuracy)\n  let weights: FertilizerWeights[] = fertilizers.map(v => ({\n    id: v.id,\n    weight: max_iterations,\n    base_weight: max_iterations\n  }))\n\n  let ignoredElements: Elements = getEmptyElements()\n  for (let [key, flag] of entries(ignore)) {\n    if (flag) {\n      ignoredElements[key] = 1\n    }\n  }\n\n  let best_score = 1000000;\n  let score;\n  let score_percent = 0;\n  let calculatedElements: Elements = getEmptyElements()\n\n  const accuracyList = [0.2, 0.1, 0.05, 0.01]\n  let step = accuracyList[0] * 10;\n\n  for (let currentAccuracy of accuracyList) {\n    if (currentAccuracy < accuracy) {\n      break\n    }\n\n    const _step = step\n    const weightRanges = weights.map(w => {\n      const ranges = []\n      const weight = w.weight < _step ? _step : w.weight\n      let minWeight = weight - _step\n      let maxWeight = weight + _step\n      if (weight === max_iterations) {\n        // Maybe first iteration\n        minWeight = 0\n        maxWeight = max_iterations\n      }\n      for (let i = minWeight; i <= maxWeight; i += _step) {\n        ranges.push(i)\n      }\n      return ranges\n    })\n\n\n    const it = product(...weightRanges)\n\n    for (let portions of it) {\n      let n_el: Elements = sumFertilizers(fertilizers, portions)\n      let score_el: Elements = getScoreElement(needElements, n_el)\n\n      for (let [e, v] of entries(ignoredElements)) {\n        if (v) {\n          score_el[e] = 0\n        }\n      }\n\n      count += 1\n      const current_score = sum(Object.values(score_el))\n      score = sum(Object.values(score_el).map(v => Math.pow(v, 2)))\n      if (best_score > score) {\n        calculatedElements = n_el\n        best_score = score\n        score_percent = current_score\n        weights.forEach((v, index) => {\n          v.base_weight = portions[index]\n          v.weight = portions[index]\n        })\n      }\n    }\n    weights = weights.filter(v => v.weight > 0)\n    let newFertilizers: Fertilizer[] = []\n    for (let f of fertilizers) {\n      for (let w of weights) {\n        if (w.id === f.id) {\n          newFertilizers.push(f)\n        }\n      }\n    }\n    fertilizers = newFertilizers\n    step = currentAccuracy * 10;\n  }\n\n\n  for (let [k, v] of entries(calculatedElements)) {\n    calculatedElements[k] = round(v)\n  }\n\n  const deltaElementsPairs = entries(calculatedElements).map(([k, v]) => {\n    return [k, needElements?.[k] || 0 - v]\n  })\n  const deltaElements = Object.fromEntries(deltaElementsPairs)\n\n  let ignored = sum(values(ignoredElements));\n  const needElementsLength = keys(needElements).length\n  const totalScore = Math.round(100 / ((score_percent - (needElementsLength - ignored)) / (needElementsLength - ignored) + 1))\n  return {\n    fertilizers: weights.map(v => ({...v, weight: round(v.weight / 10, precision)})),\n    score: totalScore,\n    elements: calculatedElements,\n    deltaElements,\n    stats: {\n      time: (new Date().getTime() - time) / 1000,\n      count: count,\n    }\n  }\n}\n","import {all, call, fork, put, select, takeLatest} from 'redux-saga/effects'\nimport {actionTypes, change, FormAction, getFormValues, stopSubmit} from \"redux-form\";\nimport {CALCULATE_START, FERTILIZERS_PUSH, LOAD_STATE_START, REDUX_FORM_NAME} from \"./constants\";\nimport {\n  calculateError,\n  calculateStart,\n  calculateSuccess, fertilizerPush,\n  loadStateStart,\n  loadStateSuccess,\n  storeCalculateForm,\n  toppingUpSuccess\n} from \"./actions\";\nimport {calculate_v4} from \"@/calculator\";\nimport {CalculatorFormValues} from \"./types\";\nimport {calculateToppingUp, getEmptyElements, getNPKDetailInfo} from \"@/calculator/helpers\";\nimport {update} from \"@/utils\";\n\nexport function* loadCalculatorStateSaga(action: ReturnType<typeof loadStateStart>) {\n  // Здесь будет валидация и конвертация между несовместимыми версиями\n  const state = action.payload\n\n  yield put(loadStateSuccess({\n    ...state.calculator\n  }))\n}\n\n\nexport function* storeCalculateFormSaga() {\n  const formValues: CalculatorFormValues = yield select(getFormValues(REDUX_FORM_NAME))\n\n  yield put(storeCalculateForm(formValues))\n  // yield put(calculateStart())\n}\n\nexport function* calculateStartSaga() {\n  const formValues: CalculatorFormValues = yield select(\n    state => state.calculator.calculationForm\n  )\n\n  if (!formValues.fertilizers.length) {\n    yield put(stopSubmit(REDUX_FORM_NAME, {\n      fertilizers: {_error: \"Need fertilizers!\"}\n    }))\n    yield put(calculateError())\n    return\n  }\n  const {\n    ignore,\n    accuracy,\n    solution_volume,\n    solution_concentration,\n    topping_up_enabled,\n    topping_up,\n  } = formValues\n\n\n  // Тут замораживается UI из за вычислений. нужно либо оптимизировать либо использовать WebWorker\n  const result = calculate_v4(\n    formValues.recipe,\n    formValues.fertilizers,\n    {\n      ignore: {...ignore},\n      accuracy,\n      solution_volume,\n      solution_concentration,\n    }\n  )\n  if (topping_up_enabled && topping_up) {\n    const toppingUpResult = yield select(\n      state => state.calculator.toppingUpResult\n    )\n    let tRes = calculateToppingUp({\n      currentSolution: topping_up.currentSolution,\n      newSolution: {\n        ...topping_up.newSolution,\n        EC: getNPKDetailInfo({...getEmptyElements(), ...formValues.recipe}).EC\n      }\n    });\n    yield put(toppingUpSuccess(tRes))\n    let doRecalculate = false\n    if (tRes.volume !== solution_volume) {\n      yield put(change(REDUX_FORM_NAME, 'solution_volume', tRes.volume))\n      doRecalculate = true\n    }\n    if (tRes.concentration !== solution_concentration.k) {\n      yield put(change(REDUX_FORM_NAME, 'solution_concentration', tRes.concentration))\n      doRecalculate = true\n    }\n    if (tRes.volume !== toppingUpResult.volume || tRes.concentration !== toppingUpResult.concentration) {\n      doRecalculate = true\n    }\n    if (doRecalculate) {\n      yield put(calculateStart())\n    }\n\n  }\n  yield put(calculateSuccess(result))\n}\n\nfunction* fertilizerPushSaga(action: ReturnType<typeof fertilizerPush>) {\n  const formValues: CalculatorFormValues = yield select(\n    state => state.calculator.calculationForm\n  )\n  const [newFertilizers, updated] = update(formValues?.fertilizers || [], action.payload, \"id\")\n  if (updated) {\n    yield put(storeCalculateForm({...formValues, fertilizers: newFertilizers}))\n  }\n}\n\nexport function* fertilizersPushWatcher() {\n  yield takeLatest(FERTILIZERS_PUSH, fertilizerPushSaga)\n}\n\nexport function* loadStateSagaWatcher() {\n  yield takeLatest(LOAD_STATE_START, loadCalculatorStateSaga);\n}\n\nexport function* calculatorSagaWatcher() {\n  yield takeLatest(CALCULATE_START, calculateStartSaga);\n}\n\nexport function* calculatorFormChangeWatcher() {\n\n  yield takeLatest([\n      actionTypes.CHANGE,\n      actionTypes.BLUR,\n      actionTypes.ARRAY_PUSH,\n      actionTypes.ARRAY_REMOVE\n    ],\n    function* (action: FormAction) {\n      if (action.meta.form === REDUX_FORM_NAME) {\n        yield call(storeCalculateFormSaga)\n      }\n    });\n}\n\nexport default function* calculatorRootSaga() {\n  yield all([\n    fork(fertilizersPushWatcher),\n    fork(calculatorSagaWatcher),\n    fork(calculatorFormChangeWatcher),\n    fork(loadStateSagaWatcher)\n  ]);\n}\n","import {all, call, fork, put, select, takeLatest} from \"redux-saga/effects\";\nimport {actionTypes, change, FormAction, getFormValues} from \"redux-form\";\nimport {FERTILIZER_EDIT_FORM_NAME} from \"./constants\";\nimport {AddEditFormType} from \"@/components/Calculator/FertilizerManager/types\";\nimport {normalizeFertilizer} from \"@/calculator/fertilizer\";\nimport {equal} from \"@/utils\";\n\nfunction* updateFertilizerForm() {\n  const formValues: AddEditFormType = yield select(getFormValues(FERTILIZER_EDIT_FORM_NAME))\n  if (formValues.composition_enable) {\n    const npk = normalizeFertilizer(\n      {id:'', composition: formValues.composition},\n      false\n    ).elements\n    if (!equal(formValues.npk, npk)) {\n      yield put(change(FERTILIZER_EDIT_FORM_NAME, 'npk', npk))\n    }\n    if (!formValues.composition?.length) {\n      yield put(change(FERTILIZER_EDIT_FORM_NAME, 'composition', [{formula: ''}]))\n\n    }\n  }\n\n}\n\nfunction* fertilizerEditFormChangeWatcher() {\n  yield takeLatest([\n      actionTypes.CHANGE,\n      actionTypes.BLUR,\n      actionTypes.ARRAY_PUSH,\n      actionTypes.ARRAY_REMOVE\n    ],\n    function* (action: FormAction) {\n      if (action.meta.form === FERTILIZER_EDIT_FORM_NAME) {\n        yield call(updateFertilizerForm)\n      }\n    });\n}\n\nexport default function* fertilizerManagerRootSaga() {\n  yield all([\n    fork(fertilizerEditFormChangeWatcher)\n  ]);\n}\n","import {all, fork} from 'redux-saga/effects'\nimport calculatorRootSaga from \"./components/Calculator/saga\";\nimport fertilizerManagerRootSaga from './components/Calculator/FertilizerManager/saga';\n\ntype AnySagaGenerator = Generator<any, any, any>;\n\nconst sagas: (() => AnySagaGenerator)[] = [\n  calculatorRootSaga,\n  fertilizerManagerRootSaga,\n]\n\nexport default function* rootSaga() {\n  yield all(sagas.map(s => fork(s)))\n}\n","export function assertNever<TState>(state: TState, _: never): TState {\n  return state;\n}\n","import {FertilizerInfo} from \"@/calculator/types\";\n\nexport const defaultFertilizers: FertilizerInfo[] = [\n  {id: \"Сульфат магния (MgSO4*7H2O)\", composition: [{formula: \"MgSO4*7H2O\", percent: 98}]},\n  {id: \"Нитрат аммония (NH4NO3)\", composition: [{formula: \"NH4NO3\", percent: 98}]},\n  {id: \"Нитрат калия (KNO3)\", composition: [{formula: \"KNO3\", percent: 98}]},\n  {id: \"Сульфат калия (K2SO4)\", composition: [{formula: \"K2SO4\", percent: 98}]},\n  {id: \"Монофосфат калия (KH2PO4)\", composition: [{formula: \"KH2PO4\", percent: 98}]},\n  {id: \"Кальциевая селитра 4-в. (Ca(NO3)2*4H2O)\", composition: [{formula: \"Ca(NO3)2*4H2O\", percent: 98}]},\n  {id: \"Сульфат аммония (NH4)2SO4)\", composition: [{formula: \"(NH4)2SO4\", percent: 98}]},\n  {id: \"Магниевая селитра 6-в. (Mg(NO3)2*6Н2О)\", composition: [{formula: \"Mg(NO3)2*6Н2О\", percent: 98}]},\n  {id: \"Хлорид кальция 6-в. (CaCl2*6H2O)\", composition: [{formula: \"CaCl2*6H2O\", percent: 98}]},\n]\n","import {ActionTypes, CalculatorState} from \"./types\";\nimport * as ActionNames from \"./constants\";\nimport {assertNever} from \"@/redux-helpers/helpers\";\nimport {defaultFertilizers} from \"./constants/fertilizers\";\nimport {DEFAULT_RECIPES} from \"./constants/recipes\";\nimport {updateOrPush} from \"@/utils\";\n\nconst initialState: CalculatorState = {\n  calculationForm: null,\n  toppingUpResult: null,\n  result: null,\n  process: false,\n  error: false,\n  fertilizers: defaultFertilizers,\n  recipes: DEFAULT_RECIPES,\n}\n\n\nexport const reducer = (state: CalculatorState = initialState, action: ActionTypes): CalculatorState => {\n  switch (action.type) {\n    case ActionNames.STORE_CALCULATE_FORM:\n      return {...state, calculationForm: action.form}\n    case ActionNames.CALCULATE_START:\n      return {...state, process: true}\n    case ActionNames.CALCULATE_SUCCESS:\n      return {...state, process: false, result: action.result}\n    case ActionNames.CALCULATE_ERROR:\n      return {...state, process: false, error: true}\n    case ActionNames.TOPPING_UP_SUCCESS:\n      return {...state, toppingUpResult: action.result}\n\n    case ActionNames.FERTILIZERS_PUSH:\n      return {\n        ...state,\n        fertilizers: updateOrPush(state.fertilizers, action.payload, 'id'),\n      }\n    case ActionNames.FERTILIZERS_REMOVE:\n      return {...state, fertilizers: state.fertilizers.filter(f => action.payload.id !== f.id)}\n    case ActionNames.FERTILIZERS_SET:\n      return {...state, fertilizers: action.payload}\n    case ActionNames.FERTILIZERS_RESET:\n      return {...state, fertilizers: [...defaultFertilizers]}\n\n    case ActionNames.RECIPE_PUSH:\n      return {...state, recipes: updateOrPush(state.recipes, action.payload, 'name')}\n    case ActionNames.RECIPE_REMOVE:\n      return {...state, recipes: state.recipes.filter(f => action.payload.name !== f.name)}\n    case ActionNames.RECIPE_RESET:\n      return {...state, recipes: [...DEFAULT_RECIPES]}\n    case ActionNames.LOAD_STATE_START:\n      // Noop\n      return {...state}\n    case ActionNames.LOAD_STATE_SUCCESS:\n      return {...state, ...action.payload}\n    default:\n      return assertNever<CalculatorState>(state, action)\n  }\n}\n","import {combineReducers} from \"redux\";\nimport {reducer as calculateReducer} from \"../components/Calculator/reducers\";\nimport {reducer as formReducer} from \"redux-form\";\n\nexport const rootReducers = combineReducers({\n  calculator: calculateReducer,\n  form: formReducer\n})\n","import {applyMiddleware, compose, createStore} from 'redux'\nimport createSagaMiddleware from 'redux-saga'\nimport rootSaga from \"../saga\";\n\nimport {rootReducers} from \"./rootReducers\";\nimport {defaultFertilizers} from \"@/components/Calculator/constants/fertilizers\";\nimport {DEFAULT_RECIPES} from \"@/components/Calculator/constants/recipes\";\n\n\nconst composeEnhancers = (window as any).__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;\n\nconst sagaMiddleware = createSagaMiddleware()\n\nfunction loadPersistedState() {\n  let state: any = {}\n  if (localStorage.getItem('reduxState')) {\n    state = JSON.parse(localStorage.getItem('reduxState') as string)\n    if (state?.calculator && !state.calculator.fertilizers) {\n      state.calculator.fertilizers = defaultFertilizers\n    }\n    if (state?.calculator && !state.calculator.recipes) {\n      state.calculator.recipes = DEFAULT_RECIPES\n    }\n  }\n  return state\n}\n\nconst persistedState = loadPersistedState()\n\nconst middlewares = [sagaMiddleware]\n\nconst enhancers = composeEnhancers(\n    applyMiddleware(...middlewares),\n  )\n\n// TODO typing\nexport const store = createStore(\n  rootReducers,\n  persistedState,\n  enhancers\n)\n\nstore.subscribe(() => {\n  localStorage.setItem('reduxState', JSON.stringify(store.getState()))\n})\n\nsagaMiddleware.run(rootSaga)\n","import React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport * as serviceWorker from './serviceWorker';\n\nimport Root from './Root'\nimport {store} from \"./redux\";\n\n\nReactDOM.render(\n  <React.StrictMode>\n    <Root store={store}/>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.register();\n\n","import {entries, keys, round, sum, values} from \"../utils\";\nimport {calculateMassParts, parseMolecule, parseNitrates} from \"./chem\";\nimport {AtomNameType, NPKOxides} from \"./constants\";\nimport {getEmptyElements} from \"./helpers\";\nimport {Elements, Fertilizer, FertilizerComposition, FertilizerInfo, NPKElements} from \"@/calculator/types\";\nimport {FertilizerWeights} from \"@/calculator/index\";\n\n/**\n * Создается удобрения по npk элементов\n * @param id удобрения\n * @param npk удобрения, проценты даются для оксидов\n */\nexport function buildNPKFertilizer(id: string, npk: NPKElements): FertilizerInfo {\n  const composition: FertilizerComposition[] = entries(npk)\n    .filter(v => v[1] > 0)\n    .map(([k, v]) => {\n        let oxide: string = k\n        if (NPKOxides.hasOwnProperty(k)) {\n          oxide = NPKOxides[k] as string\n        }\n        return {\n          formula: oxide,\n          percent: v\n        }\n      }\n    )\n  return {\n    id,\n    composition,\n  }\n}\n\n/**\n * Состав удобрения в NPK\n * @param composition\n * @return Elements - npk чистых элементов, не оксидов!\n */\nexport function compositionToElements(composition: FertilizerComposition[]): Elements {\n  const elements: Elements = getEmptyElements()\n  for (let comp of composition) {\n    let atomCounts = parseMolecule(comp.formula)\n    let massParts = calculateMassParts(atomCounts)\n    for (let [atom, mass] of entries(massParts)) {\n      let subAtoms = {[atom]: 1}\n      if (atom === \"N\") {\n        subAtoms = parseNitrates(comp.formula)\n        if (keys(elements).includes(comp.formula as keyof Elements)) {\n          mass = 1\n        }\n      }\n      const totalSubAtoms = sum(values(subAtoms))\n      for (let [a, k] of entries(subAtoms)) {\n        if (elements.hasOwnProperty(a)) {\n          let percent = 100\n          if (comp.percent) {\n            percent = comp.percent;\n          }\n          percent *= (k / totalSubAtoms)\n          elements[a as keyof Elements] += percent * mass\n        }\n      }\n    }\n  }\n  for (let k of keys(elements)) {\n    if (elements[k]) {\n      elements[k] = round(elements[k], 3)\n    }\n  }\n  return elements\n}\n\n/**\n * Конвертация чистых элементов в NPK оксиды\n * @param {Elements} elements - чистые элементы\n * @param precision\n */\nexport function elementsToNPK(elements: Partial<Elements>, precision = 3): NPKElements {\n  const e = entries(elements).map(([atom, val]) => {\n    const oxide: string = (NPKOxides as any)[atom] || atom\n    const massParts = calculateMassParts(parseMolecule(oxide))\n    const skipElements = massParts.hasOwnProperty(\"N\") || massParts.hasOwnProperty(\"S\")\n    const elementMassPart = massParts[atom as AtomNameType]\n    if (!skipElements && elementMassPart) {\n      const k = round(sum(values(massParts)) / elementMassPart, precision)\n      val = round(val * k, precision)\n    }\n    return [atom, val]\n  })\n  return Object.fromEntries(e)\n}\n\n/**\n * Расчет состава удобрения в чистые элементы\n * @param {FertilizerInfo} fertilizerInfo\n * @param convertMass - преобразовать ли в чистые элементы\n * @return {Fertilizer}\n */\nexport function normalizeFertilizer(fertilizerInfo: FertilizerInfo, convertMass = true): Fertilizer {\n  let elements: Elements = getEmptyElements()\n  let composition = fertilizerInfo.composition;\n  if (fertilizerInfo.npk) {\n    composition = buildNPKFertilizer(fertilizerInfo.id, fertilizerInfo.npk).composition\n  }\n  if (composition) {\n    elements = compositionToElements(composition)\n  }\n  if (!convertMass) {\n    // Оксиды нужны только для отображения.\n    elements = elementsToNPK(elements) as Elements\n  }\n  return {\n    id: fertilizerInfo.id,\n    elements\n  }\n\n}\n\n\nexport interface BuildFertilizerFromSolutionOptions {\n  fertilizers: FertilizerInfo[],\n  fertilizer_weights: FertilizerWeights[],\n  // По умолчанию - 1л\n  volume?: number | null,\n}\n\n/*\n  Создание комплексного удобрения из расчета.\n  Таким образом можно учитывать заранее намешанные концентраты\n */\nexport function buildFertilizerFromSolution(id: string, options: BuildFertilizerFromSolutionOptions): FertilizerInfo {\n  const _fertsWeights = Object.fromEntries(options.fertilizer_weights.map(f => [f.id, f]))\n  const totalWeight = sum(options.fertilizer_weights.map(f => f.weight))\n  const totalWeightPerElements = getEmptyElements()\n  let newNpk: NPKElements = {};\n\n  for (let f of options.fertilizers) {\n    if (!_fertsWeights?.[f.id]) {\n      continue\n    }\n    const f_weight = _fertsWeights?.[f.id]\n    const nf = normalizeFertilizer(f)\n    for (let [_el, _el_percent] of entries(nf.elements)) {\n      if (_el_percent > 0) {\n        totalWeightPerElements[_el] += f_weight.weight * (_el_percent / 100)\n      }\n    }\n  }\n\n  for (let [el, el_weight] of entries(totalWeightPerElements)) {\n    if (el_weight > 0) {\n      newNpk[el] = (el_weight * 100) / totalWeight\n    }\n  }\n\n  const newFertilizer: FertilizerInfo = {\n    id,\n    npk: elementsToNPK(newNpk, 3),\n    solution_concentration: totalWeight / (options.volume || 1)\n  }\n  return newFertilizer;\n}\n","export const ATOMIC_MASS = {\n  \"H\": 1.008,\n  \"He\": 4.0026022,\n  \"Li\": 6.94,\n  \"Be\": 9.01218315,\n  \"B\": 10.81,\n  \"C\": 12.011,\n  \"N\": 14.007,\n  \"O\": 15.999,\n  \"F\": 18.9984031636,\n  \"Ne\": 20.17976,\n  \"Na\": 22.989769282,\n  \"Mg\": 24.305,\n  \"Al\": 26.98153857,\n  \"Si\": 28.085,\n  \"P\": 30.9737619985,\n  \"S\": 32.065,\n  \"Cl\": 35.45,\n  \"K\": 39.09831,\n  \"Ar\": 39.9481,\n  \"Ca\": 40.0784,\n  \"Sc\": 44.9559085,\n  \"Ti\": 47.8671,\n  \"V\": 50.94151,\n  \"Cr\": 51.99616,\n  \"Mn\": 54.9380443,\n  \"Fe\": 55.8452,\n  \"Ni\": 58.69344,\n  \"Co\": 58.9331944,\n  \"Cu\": 63.5463,\n  \"Zn\": 65.382,\n  \"Ga\": 69.7231,\n  \"Ge\": 72.6308,\n  \"As\": 74.9215956,\n  \"Se\": 78.9718,\n  \"Br\": 79.904,\n  \"Kr\": 83.7982,\n  \"Rb\": 85.46783,\n  \"Sr\": 87.621,\n  \"Y\": 88.905842,\n  \"Zr\": 91.2242,\n  \"Nb\": 92.906372,\n  \"Mo\": 95.951,\n  \"Tc\": 98,\n  \"Ru\": 101.072,\n  \"Rh\": 102.905502,\n  \"Pd\": 106.421,\n  \"Ag\": 107.86822,\n  \"Cd\": 112.4144,\n  \"In\": 114.8181,\n  \"Sn\": 118.7107,\n  \"Sb\": 121.7601,\n  \"I\": 126.904473,\n  \"Te\": 127.603,\n  \"Xe\": 131.2936,\n  \"Cs\": 132.905451966,\n  \"Ba\": 137.3277,\n  \"La\": 138.905477,\n  \"Ce\": 140.1161,\n  \"Pr\": 140.907662,\n  \"Nd\": 144.2423,\n  \"Pm\": 145,\n  \"Sm\": 150.362,\n  \"Eu\": 151.9641,\n  \"Gd\": 157.253,\n  \"Tb\": 158.925352,\n  \"Dy\": 162.5001,\n  \"Ho\": 164.930332,\n  \"Er\": 167.2593,\n  \"Tm\": 168.934222,\n  \"Yb\": 173.0451,\n  \"Lu\": 174.96681,\n  \"Hf\": 178.492,\n  \"Ta\": 180.947882,\n  \"W\": 183.841,\n  \"Re\": 186.2071,\n  \"Os\": 190.233,\n  \"Ir\": 192.2173,\n  \"Pt\": 195.0849,\n  \"Au\": 196.9665695,\n  \"Hg\": 200.5923,\n  \"Tl\": 204.38,\n  \"Pb\": 207.21,\n  \"Bi\": 208.980401,\n  \"Po\": 209,\n  \"At\": 210,\n  \"Rn\": 222,\n  \"Fr\": 223,\n  \"Ra\": 226,\n  \"Ac\": 227,\n  \"Pa\": 231.035882,\n  \"Th\": 232.03774,\n  \"Np\": 237,\n  \"U\": 238.028913,\n  \"Am\": 243,\n  \"Pu\": 244,\n  \"Cm\": 247,\n  \"Bk\": 247,\n  \"Cf\": 251,\n  \"Es\": 252,\n  \"Fm\": 257,\n  \"Md\": 258,\n  \"No\": 259,\n  \"Lr\": 266,\n  \"Rf\": 267,\n  \"Db\": 268,\n  \"Sg\": 269,\n  \"Hs\": 269,\n  \"Bh\": 270,\n  \"Mt\": 278,\n  \"Ds\": 281,\n  \"Rg\": 282,\n  \"Cn\": 285,\n  \"Nh\": 286,\n  \"Fl\": 289,\n  \"Mc\": 289,\n  \"Lv\": 293,\n  \"Ts\": 294,\n  \"Og\": 294,\n  \"Uue\": 315\n}\nexport type AtomNameType = keyof ATOMIC_MASS\nexport type ATOMIC_MASS = typeof ATOMIC_MASS;\nexport const MACRO_ELEMENT_NAMES = [\"NO3\", \"NH4\", \"P\", \"K\", \"Ca\", \"Mg\", \"S\", \"Cl\"] as const\nexport type MACRO_ELEMENT_NAMES = typeof MACRO_ELEMENT_NAMES[number]\nexport const MICRO_ELEMENT_NAMES = ['Fe', 'Mn', 'B', 'Zn', 'Cu', 'Mo', 'Co', 'Si'] as const\nexport type MICRO_ELEMENT_NAMES = typeof MICRO_ELEMENT_NAMES[number]\n\nexport const FERTILIZER_ELEMENT_NAMES = [...MACRO_ELEMENT_NAMES, ...MICRO_ELEMENT_NAMES]\nexport type FERTILIZER_ELEMENT_NAMES = typeof FERTILIZER_ELEMENT_NAMES[number]\n\nexport const IONIC_STRENGTH = {\n  NO3: -1 / ATOMIC_MASS[\"N\"],\n  NH4: 1 / ATOMIC_MASS[\"N\"],\n  P: -1 / ATOMIC_MASS[\"P\"],\n  K: 1 / ATOMIC_MASS[\"K\"],\n  Ca: 2 / ATOMIC_MASS[\"Ca\"],\n  Mg: 2 / ATOMIC_MASS[\"Mg\"],\n  S: -2 / ATOMIC_MASS[\"S\"],\n  // TODO use for balance without recipe\n  Cl: -1 / ATOMIC_MASS[\"Cl\"],\n  Na: 1 / ATOMIC_MASS[\"Na\"],\n}\n\nexport const NPKOxides = {\n  NO3: 'NO3',\n  NH4: 'NH4',\n  P: 'P2O5',\n  K: 'K2O',\n  Ca: 'CaO',\n  Mg: 'MgO',\n}","import * as ActionNames from \"./constants\";\nimport {CalculateResult} from \"@/calculator\";\nimport {CalculatorFormValues, CalculatorState, FertilizerInfo, Recipe} from \"@/components/Calculator/types\";\nimport {CalculateToppingUpResult} from \"@/calculator/helpers\";\nimport {ExportStateType} from \"@/calculator/format/types\";\n\nexport const storeCalculateForm = (form: CalculatorFormValues) => ({\n  type: ActionNames.STORE_CALCULATE_FORM,\n  form,\n} as const)\n\nexport const calculateStart = () => ({\n  type: ActionNames.CALCULATE_START,\n} as const)\n\nexport const calculateSuccess = (result: CalculateResult) => ({\n  type: ActionNames.CALCULATE_SUCCESS,\n  result\n} as const)\n\nexport const calculateError = () => ({\n  type: ActionNames.CALCULATE_ERROR,\n} as const)\n\nexport const fertilizerPush = (payload: FertilizerInfo) => ({\n  type: ActionNames.FERTILIZERS_PUSH,\n  payload\n})\n\nexport const fertilizerRemove = (payload: FertilizerInfo) => ({\n  type: ActionNames.FERTILIZERS_REMOVE,\n  payload\n})\n\nexport const fertilizerSet = (payload: FertilizerInfo[]) => ({\n  type: ActionNames.FERTILIZERS_SET,\n  payload,\n})\n\nexport const fertilizerReset = () => ({\n  type: ActionNames.FERTILIZERS_RESET,\n})\n\n\nexport const recipePush = (payload: Recipe) => ({\n  type: ActionNames.RECIPE_PUSH,\n  payload\n})\n\nexport const recipeRemove = (payload: Recipe) => ({\n  type: ActionNames.RECIPE_REMOVE,\n  payload\n})\n\nexport const recipeReset = () => ({\n  type: ActionNames.RECIPE_RESET,\n})\n\nexport const loadStateStart = (payload: ExportStateType) => ({\n  type: ActionNames.LOAD_STATE_START,\n  payload\n})\n\n// Commit state\nexport const loadStateSuccess = (payload: Partial<CalculatorState>) => ({\n  type: ActionNames.LOAD_STATE_SUCCESS,\n  payload\n})\n\n\nexport const toppingUpSuccess = (result: CalculateToppingUpResult) => ({\n  type: ActionNames.TOPPING_UP_SUCCESS,\n  result\n} as const)\n","import {Elements, NPKElements} from \"./types\";\nimport {entries, round} from \"../utils\";\nimport {ATOMIC_MASS, FERTILIZER_ELEMENT_NAMES, NPKOxides} from \"./constants\";\nimport {HPGFormat} from \"./format/hpg\";\nimport {compositionToElements, elementsToNPK} from \"./fertilizer\";\nimport {ElementsMatrixType, getProfileRatioMatrix} from \"./ratio\";\n\n// export interface ProfileInfo {\n//   ratio: ElementsMatrixType\n//   anions: number,\n//   cations: number,\n//   ion_balance: number,\n//   EC: number\n// }\n\n// export interface ChangeProfileOptions {\n//   ratio: Partial<ElementInMatrix<Partial<ElementInMatrix>>>,\n//   EC: number,\n//\n// }\n//\n// export interface ChangeProfileResult {\n//   npk: Elements,\n//   info: ProfileInfo\n// }\n//\n// // export function changeProfile(npk: Elements, options: ChangeProfileOptions): ChangeProfileResult {\n// //\n// // }\n\ninterface ProfileCationsAnionsResult {\n  cations: number,\n  anions: number,\n}\n\nexport function profileCationsAnions(npk: NPKElements): ProfileCationsAnionsResult {\n  const cations = (\n    ((npk.NH4 || 0) / ATOMIC_MASS.N)\n    + ((npk.K || 0) / ATOMIC_MASS.K)\n    + ((2 * (npk.Ca || 0)) / ATOMIC_MASS.Ca)\n    + ((2 * (npk.Mg || 0)) / ATOMIC_MASS.Mg)\n  )\n  const anions = (\n    ((npk.NO3 || 0) / ATOMIC_MASS.N)\n    + ((npk.P || 0) / ATOMIC_MASS.P)\n    + ((2 * (npk.S || 0)) / ATOMIC_MASS.S)\n    + ((npk.Cl || 0) / ATOMIC_MASS.Cl)\n  )\n\n  return {\n    cations,\n    anions\n  }\n}\n\n/**\n * Расчет ЕС профиля по формуле Зоневельд\n * @param npk\n */\nexport function calculateEC(npk: NPKElements): number {\n  const cations = profileCationsAnions(npk).cations\n  return round((0.095 * cations) + 0.19, 3)\n}\n\n/**\n * Расчет ионного баланса\n * @param npk\n */\nexport function calculateIonicBalance(npk: NPKElements): number {\n  const cat_an = profileCationsAnions(npk)\n  return round(cat_an.cations - cat_an.anions, 3)\n\n}\n\n/**\n * Нормализация ионного баланса по сере\n * @param npk\n */\nexport function fixIonicBalanceByS(npk: NPKElements): number {\n  const M_NH4 = ATOMIC_MASS.N;\n  const M_NO3 = ATOMIC_MASS.N;\n  const M_P = ATOMIC_MASS.P;\n  const M_K = ATOMIC_MASS.K;\n  const M_Ca = ATOMIC_MASS.Ca;\n  const M_Mg = ATOMIC_MASS.Mg;\n  const M_S = ATOMIC_MASS.S;\n  const M_Cl = ATOMIC_MASS.Cl;\n\n  const m_NH4 = npk.NH4 || 0;\n  const m_NO3 = npk.NO3 || 0;\n  const m_P = npk.P || 0;\n  const m_K = npk.K || 0;\n  const m_Ca = npk.Ca || 0;\n  const m_Mg = npk.Mg || 0;\n  const m_Cl = npk.Cl || 0;\n\n  // Формула получена путем обратного решения формулы ионного баланса\n  const mS = (\n    (\n      -M_Ca * M_Cl * M_K * M_Mg * M_NH4 * M_NO3 * M_S * m_P\n      - M_Ca * M_Cl * M_K * M_Mg * M_NH4 * M_P * M_S * m_NO3\n      + M_Ca * M_Cl * M_K * M_Mg * M_NO3 * M_P * M_S * m_NH4\n      + 2 * M_Ca * M_Cl * M_K * M_NH4 * M_NO3 * M_P * M_S * m_Mg\n      + M_Ca * M_Cl * M_Mg * M_NH4 * M_NO3 * M_P * M_S * m_K\n      - M_Ca * M_K * M_Mg * M_NH4 * M_NO3 * M_P * M_S * m_Cl\n      + 2 * M_Cl * M_K * M_Mg * M_NH4 * M_NO3 * M_P * M_S * m_Ca\n    ) / (2 * M_Ca * M_Cl * M_K * M_Mg * M_NH4 * M_NO3 * M_P)\n  )\n  return round(mS, 3)\n}\n\n/**\n * Нормализация ионного баланса по кальцию\n * @param npk\n */\nexport function fixIonicBalanceByCa(npk: NPKElements): number {\n  const M_NH4 = ATOMIC_MASS.N;\n  const M_NO3 = ATOMIC_MASS.N;\n  const M_P = ATOMIC_MASS.P;\n  const M_K = ATOMIC_MASS.K;\n  const M_Ca = ATOMIC_MASS.Ca;\n  const M_Mg = ATOMIC_MASS.Mg;\n  const M_S = ATOMIC_MASS.S;\n  const M_Cl = ATOMIC_MASS.Cl;\n\n  const m_NH4 = npk.NH4 || 0;\n  const m_NO3 = npk.NO3 || 0;\n  const m_P = npk.P || 0;\n  const m_K = npk.K || 0;\n  const m_Mg = npk.Mg || 0;\n  const m_S = npk.S || 0;\n  const m_Cl = npk.Cl || 0;\n\n  // Формула получена путем обратного решения формулы ионного баланса\n  const mCa = (\n    (2 * M_Ca * M_Cl * M_K * M_Mg * M_NH4 * M_NO3 * M_P * m_S\n      + M_Ca * M_Cl * M_K * M_Mg * M_NH4 * M_NO3 * M_S * m_P\n      + M_Ca * M_Cl * M_K * M_Mg * M_NH4 * M_P * M_S * m_NO3\n      - M_Ca * M_Cl * M_K * M_Mg * M_NO3 * M_P * M_S * m_NH4\n      - 2 * M_Ca * M_Cl * M_K * M_NH4 * M_NO3 * M_P * M_S * m_Mg\n      - M_Ca * M_Cl * M_Mg * M_NH4 * M_NO3 * M_P * M_S * m_K\n      + M_Ca * M_K * M_Mg * M_NH4 * M_NO3 * M_P * M_S * m_Cl\n    ) / (2 * M_Cl * M_K * M_Mg * M_NH4 * M_NO3 * M_P * M_S)\n  )\n  return round(mCa, 3)\n}\n\n/**\n * Обновления профиля по ЕС\n * Copied from siv237/HPG\n * @param npk\n * @param EC new EC\n * @param ratio\n * @return new NPK\n */\nexport function convertProfileWithEC(npk: NPKElements, EC: number, ratio?: ElementsMatrixType): NPKElements {\n  // Конвертация профиля по формуле Зоневельда\n\n  const v = ratio || getProfileRatioMatrix(npk)\n\n  const K_KN = v.K.N\n  const K_KMg = v.K.Mg\n  const K_KCa = v.K.Ca\n  const K_NH4NO3 = v.NH4.NO3\n\n  const r_N = K_KCa * K_KMg / (K_KCa * K_KMg * K_KN + K_KCa * K_KMg + K_KCa * K_KN + K_KMg * K_KN)\n  const r_NH4 = (K_NH4NO3 * r_N) / (K_NH4NO3 + 1)\n  const r_NO3 = r_N / (K_NH4NO3 + 1)\n\n  const r_K = K_KCa * K_KMg * K_KN / ((K_KCa * K_KMg * K_KN) + (K_KCa * K_KMg) + (K_KCa * K_KN + K_KMg * K_KN))\n  const r_Ca = K_KMg * K_KN / (K_KCa * K_KMg * K_KN + K_KCa * K_KMg + K_KCa * K_KN + K_KMg * K_KN)\n  const r_Mg = K_KCa * K_KN / (K_KCa * K_KMg * K_KN + K_KCa * K_KMg + K_KCa * K_KN + K_KMg * K_KN)\n\n  const M_NH4 = ATOMIC_MASS.N;\n  const M_K = ATOMIC_MASS.K;\n  const M_Ca = ATOMIC_MASS.Ca;\n  const M_Mg = ATOMIC_MASS.Mg;\n\n  const m_NH4 = r_NH4;\n  const m_K = r_K;\n  const m_Ca = r_Ca;\n  const m_Mg = r_Mg;\n\n  const r = (\n    (200.0 * EC * M_Ca * M_K * M_Mg * M_NH4 - 38.0 * M_Ca * M_K * M_Mg * M_NH4)\n    / (19.0 * M_Ca * M_K * M_Mg * m_NH4 + 38.0 * M_Ca * M_K * M_NH4 * m_Mg\n      + 19.0 * M_Ca * M_Mg * M_NH4 * m_K + 38.0 * M_K * M_Mg * M_NH4 * m_Ca)\n  )\n\n  let newNpk = {\n    ...npk,\n    NH4: r_NH4 * r,\n    NO3: r_NO3 * r,\n    K: r_K * r,\n    Ca: r_Ca * r,\n    Mg: r_Mg * r,\n  }\n  // Пересчет ионного баланса по сере\n  newNpk.S = fixIonicBalanceByS(newNpk)\n\n  return Object.fromEntries(entries(newNpk)\n    .map(([el, v]) => (\n      [el, round(v, 1)]\n    )))\n}\n\n\n/**\n *\n * @param profile string like `NO3=13.577 K2O=45.668 Fe=6`\n * @return NPKElements\n */\nexport function parseProfileStringToNPK(profile: string): NPKElements {\n  const elements: Partial<Elements> = {}\n  const p = HPGFormat.parseProfileStringToObject(profile)\n  for (let [k, v] of Object.entries(p)) {\n    if (!Number.isFinite(v)) {\n      continue\n    }\n\n    // Частный случай, когда вводим N но подразумеваем NO3\n    if (k === \"N\") {\n      k = \"NO3\"\n    }\n\n    if (FERTILIZER_ELEMENT_NAMES.includes(k as FERTILIZER_ELEMENT_NAMES)) {\n      elements[k as FERTILIZER_ELEMENT_NAMES] = v\n    } else {\n      // Может быть это какой то оксид. Может даже целое уравнение.\n      const npkEl = compositionToElements(\n        // Представим это как химическую формулу\n        [{percent: v, formula: k}])\n      for (const [_e, _p] of entries(npkEl)) {\n        if (_p) {\n          elements[_e] = (elements[_e] || 0) + _p\n        }\n      }\n    }\n  }\n  // Конвертируем в оксидную форму\n  return elementsToNPK(elements)\n}\n\n/**\n *\n * @param npk\n * @returns string like `NO3=13.577 K2O=45.668 Fe=6`\n */\nexport function stringifyProfile(npk: NPKElements): string {\n  let s = FERTILIZER_ELEMENT_NAMES.map(\n    e => {\n      if (npk[e]) {\n        let n = e as string;\n        // Т.к. оперируем оксидами, то оксиды выводим как оксиды\n        if (NPKOxides.hasOwnProperty(e)) {\n          n = NPKOxides[e] as string\n        }\n        return `${n}=${npk[e]}`\n      }\n      return undefined\n    })\n    .filter(e => e).join(' ')\n  return `${s}`\n}","import {ATOMIC_MASS, AtomNameType} from \"../constants\";\n\nexport interface SubgroupType {\n  formula: string,\n  count: number\n}\n\nexport type ParsedMolecule = { [Atom in AtomNameType]?: number }\n\n/**\n * @param formula String A molecular formula, eg CH(CH(CH2)2)2OH\n * @return subgroups An array of first-level subgroups.\n * Eg [{formula: 'CH', count:1}, {formula:'CH(CH2)2', count:2,\n * {formula:'OH', count:1}]\n */\nexport const findSubgroups = function (formula: string): SubgroupType[] {\n  let finishingNestedSubgroup;\n  let subgroups: SubgroupType[] = [];\n  let currentFormula = '', currentCount = '';\n  let level = 0;\n\n  //This pushes the current state of currentFormula and currentCount to subgroups.\n  //It also resets currentFormula and currentCount.\n  const pushSubgroup = function () {\n    if (!currentFormula) return;\n    const countStr = currentCount || '1';\n    const count = parseInt(countStr, 10);\n    subgroups.push({formula: currentFormula, count: count});\n    currentFormula = '';\n    currentCount = '';\n  };\n\n  let i=-1;\n\n  for (let ch of formula) {\n    i++\n    if (/[A-Za-z]/.test(ch)) {\n      if (finishingNestedSubgroup) {\n        pushSubgroup();\n        finishingNestedSubgroup = false;\n      }\n      currentFormula += ch;\n      continue;\n    } else if (ch === '(') {\n      //If we are outside of parenthesis start a new subgroup\n      if (level === 0 && currentFormula) {\n        pushSubgroup();\n      }\n      if (level > 0) {\n        //If we are in a subgroup, the ( is part of the formula\n        currentFormula += ch;\n      }\n      level += 1;\n    } else if (ch === ')') {\n      level -= 1;\n      if (level === 0) {\n        //Finishing top-level subgroup; mark it so we can count multiples\n        finishingNestedSubgroup = true;\n      } else {\n        //If we are in a subgroup, the ( is part of the formula\n        currentFormula += ch;\n      }\n    } else if (/[*+]/.test(ch)) {\n      if (level === 0 && currentFormula) {\n        pushSubgroup();\n        finishingNestedSubgroup = false\n      }\n      if (level > 0) {\n        currentFormula += ch\n      }\n      level += 1\n    } else if (/\\d/.test(ch)) {\n      // TODO check numbers > 9\n      if (finishingNestedSubgroup) {\n        currentCount += ch;\n      } else {\n        if (!currentFormula) {\n          // Maybe like as 6H2O\n          currentCount += ch\n        } else {\n          if (i === 0) {\n            currentCount += ch\n            continue\n          }\n          currentFormula += ch;\n        }\n      }\n    }\n  }\n  //Once more to pick up any straggling formula\n  pushSubgroup();\n  return subgroups;\n}\n\n/**\n * @param formula String A primitive (ie, without subgroups/parentheses, like\n * CH4) molecular formula\n * @return elementCounts A map of element:count, eg {C:1, H:4}\n * @api private\n */\nconst _decomposePrimitiveFormula = function (formula: string): ParsedMolecule {\n  let elementCounts: ParsedMolecule = {};\n  let match = formula.match(elementRe)\n  if (!match) {\n    return elementCounts\n  }\n  for (let token of match) {\n    //matcher will be of the form ['Na2', 'Na', '2', ...] or ['H', 'H', '', ...]\n    let matcher = token.match(singleElementRe);\n    if (!matcher) {\n      continue\n    }\n    const element = matcher[1];\n    const count = parseInt((matcher[2] || '1'), 10);\n\n    if (!ATOMIC_MASS.hasOwnProperty(element)) {\n      continue\n    }\n    let _el = element as AtomNameType\n    if (element in elementCounts) {\n      elementCounts[_el] = (elementCounts[_el] || 0) + count;\n    } else {\n      elementCounts[_el] = count;\n    }\n  }\n\n\n  return elementCounts;\n};\n/**\n * @param formula String A molecular formula, eg CH(CH3)3\n * @return elementCounts A map of element:count, eg\n * {\n *   C: 4,\n *   H: 10\n * }\n */\nexport const decomposeFormula = function (formula: string): ParsedMolecule {\n  if (!formula) return {};\n  const subgroups = findSubgroups(formula);\n  if (subgroups.length === 1 && subgroups[0].formula === formula) {\n    //We have a primitive formula that we can just count!\n    return _decomposePrimitiveFormula(formula);\n  } else {\n    //We have subgroups\n    let combinedCounts: ParsedMolecule = {};\n    subgroups.forEach(function (subgroup) {\n      const subgroupCounts = decomposeFormula(subgroup.formula);\n      let elementCount;\n      for (let element in subgroupCounts) {\n        if (ATOMIC_MASS.hasOwnProperty(element)) {\n          let _el = element as AtomNameType\n          elementCount = (subgroupCounts[_el] || 0) * subgroup.count;\n          if (element in combinedCounts) {\n            combinedCounts[_el] = (combinedCounts[_el] || 0) + elementCount;\n          } else {\n            combinedCounts[_el] = elementCount;\n          }\n\n        }\n      }\n    });\n    return combinedCounts;\n  }\n}\n\nlet elementRe: RegExp = /([A-Z][a-z]{0,2})(\\d*)/g\nlet singleElementRe: RegExp = /([A-Z][a-z]{0,2})(\\d*)/\n\n\n","import {entries, sum, values} from \"../utils\";\nimport {ATOMIC_MASS, AtomNameType} from \"./constants\";\nimport {decomposeFormula, findSubgroups} from './molecular-parser/molecularParser';\n\nexport type DecomposedChemFormula = {\n  [Atom in AtomNameType]?: number;\n}\n\ntype ParsedNitrateType = {\n  NH4: number,\n  NO3: number\n}\n\n/**\n *\n * @param formula\n * @return\n */\nexport function parseMolecule(formula: string): DecomposedChemFormula {\n  return decomposeFormula(formula)\n}\n\nexport function parseNitrates(formula: string): ParsedNitrateType {\n  const nitrates: ParsedNitrateType = {\"NH4\": 0, \"NO3\": 0}\n  const re = /NH4|NO3|NH2/g\n  for (let s of findSubgroups(formula)) {\n    let subFormula = s.formula\n    if (subFormula === 'NH2') {\n      subFormula = 'NH4'\n    }\n    if (nitrates.hasOwnProperty(subFormula)) {\n      nitrates[subFormula as keyof typeof nitrates] += s.count\n      continue\n    }\n    if (subFormula !== formula) {\n      for (let [n, c] of entries(parseNitrates(subFormula))) {\n        (nitrates as ParsedNitrateType)[n] += c\n      }\n    } else {\n      for (let r of subFormula.matchAll(re)) {\n        let nType = r[0];\n        // Для мочевины, она соответствует аммонийному азоту\n        if (nType === 'NH2') {\n          nType = 'NH4'\n        }\n        (nitrates as ParsedNitrateType)[nType as keyof ParsedNitrateType] += s.count\n      }\n    }\n  }\n  return nitrates\n}\n\nexport function calculateMassParts(formula: DecomposedChemFormula): DecomposedChemFormula {\n  const atomMasses = Object.fromEntries(entries(formula).map(\n    ([atom, count]) =>\n      [atom, ATOMIC_MASS[atom] * count]\n    )\n  ) as DecomposedChemFormula\n\n  const totalMass = sum(values(atomMasses))\n  return Object.fromEntries(\n    entries(atomMasses).map(([atom, mass]) => [atom, mass / totalMass])\n  ) as DecomposedChemFormula\n}\n\n","import {FertilizerInfo} from \"./types\";\nimport {normalizeFertilizer} from \"./fertilizer\";\nimport {round} from \"../utils\";\n\nexport interface Concentration {\n  // Коэфициент разбавления. C1 = V2/V1\n  k: number,\n  // запись концентрата в Nмл на Mл\n  // Объем концентрата, в мл\n  v_1: number,\n  // Объем целевого раствора, в мл. По умолчанию 1000мл.\n  v_2: number,\n}\n\nexport interface Solution {\n  id: string,\n  // Объем в литрах\n  volume: number,\n  // в 1/100%\n  concentration: Concentration | number,\n  // TODO плотность\n}\n\nexport type DilutionResult = Omit<Solution, \"concentration\">\n\n/**\n * Разбавление раствора\n * @param target type `Solution` - целевой раствор\n * @param sources Solution[] - концентраты\n * @return DilutionResult[] - сколько нужно взять концентрата чтобы получить итоговый раствор\n */\nexport function dilution_solution(target: Solution, sources: Omit<Solution, \"volume\">[]): DilutionResult[] {\n  const t_con = normalizeConcentration(target.concentration)\n  const result: DilutionResult[] = []\n  for (let s of sources) {\n    const s_con = normalizeConcentration(s.concentration)\n    result.push({\n      id: s.id,\n      volume: round((target.volume / s_con.k) * t_con.k, 4)\n    })\n  }\n  return result\n}\n\n\ntype FertilizerGroupBySolution = { [K in \"A\" | \"B\" | \"C\"]?: FertilizerInfo[] }\n\n// Делим удобрения на несколько растворов\n// Бутылка-1 Макра-азотная\n// Селитра амиачная\n// Селитра калиевая\n// Селитра кальциевая\n//\n// Бутылка 2 Макра-серно-фосфорная\n// Сульфат аммония\n// Сульфат магния семиводный\n// Монофосфат калия\n/**\n * разделение удобрений на группы А, В и С\n * Смысл в том что удобрения могут прореагировать в растворе и выпасть в нерастворимый осадок, особенно в концентратах\n * В группу А попадают вся селитра NO3\n * В группу В попадают сульфаты и фосфаты\n * В группу С все остальное\n * @param fertilizers type FertilizerInfo[]\n */\nexport function groupFertilizerBySolution(fertilizers: FertilizerInfo[]): FertilizerGroupBySolution {\n  const groups: FertilizerGroupBySolution = {}\n  for (let f of fertilizers) {\n    let nf = normalizeFertilizer(f)\n    if (nf.elements.NO3) {\n      groups.A = [...groups.A || [], f]\n      continue\n    }\n    if (nf.elements.S || nf.elements.P) {\n      groups.B = [...groups.B || [], f]\n      continue\n    }\n    groups.C = [...groups.C || [], f]\n\n  }\n  return groups\n}\n\n\n\nexport function normalizeConcentration(concentration: Partial<Concentration> | number): Required<Concentration> {\n  if (typeof concentration == 'number') {\n    return {\n      k: concentration,\n      v_1: round(1000 / concentration, 2),\n      v_2: 1000,\n    }\n  }\n  if (concentration.v_1) {\n    return {\n      k: round((concentration.v_2 || 1000) / concentration.v_1, 2),\n      v_2: concentration.v_2 || 1000,\n      v_1: concentration.v_1\n    }\n  }\n  else if (concentration.k) {\n    return {\n      k: concentration.k,\n      v_2: 1000,\n      v_1: round(1000 / concentration.k, 2)\n    }\n  }\n  throw Error(\"Invalid concentration\")\n}","\nexport const FERTILIZER_EDIT_FORM_NAME = 'fertilizerEdit'\n","import {Recipe} from \"@/components/Calculator/types\";\nimport {NeedElements} from \"@/calculator/types\";\n\nexport const DEFAULT_MICRO_RECIPE: NeedElements = {\n  Fe: 4500 / 1000,\n  Mn: 636 / 1000,\n  B: 636 / 1000,\n  Zn: 384 / 1000,\n  Cu: 69 / 1000,\n  Mo: 69 / 1000,\n}\n\nexport const DEFAULT_RECIPES: Recipe[] = [\n  {\n    'name': 'Перец Минвата Базовый',\n    'elements': {\n      'NO3': 224.0,\n      'NH4': 14.0,\n      'P': 39.0,\n      'K': 264.0,\n      'Ca': 200.0,\n      'Mg': 36.0,\n      'S': 56.0,\n      'Cl': 0.0,\n      'Fe': 0.84,\n      'Mn': 0.55,\n      'Zn': 0.33,\n      'B': 0.32,\n      'Cu': 0.06,\n      'Mo': 0.05\n    }\n  },\n  {\n    'name': 'Перец Минвата Старт',\n    'elements': {\n      'NO3': 224.0,\n      'NH4': 0.0,\n      'P': 8.0,\n      'K': 264.0,\n      'Ca': 200.0,\n      'Mg': 36.0,\n      'S': 56.0,\n      'Cl': 0.0,\n      'Fe': 0.84,\n      'Mn': 0.55,\n      'Zn': 0.33,\n      'B': 0.32,\n      'Cu': 0.06,\n      'Mo': 0.05\n    }\n  },\n  {\n    'name': 'Перец Минвата Жара',\n    'elements': {\n      'NO3': 224.0,\n      'NH4': 7.0,\n      'P': 39.0,\n      'K': 225.0,\n      'Ca': 220.0,\n      'Mg': 43.0,\n      'S': 56.0,\n      'Cl': 0.0,\n      'Fe': 1.4,\n      'Mn': 0.55,\n      'Zn': 0.33,\n      'B': 0.43,\n      'Cu': 0.06,\n      'Mo': 0.05\n    }\n  },\n  {\n    'name': 'Перец Минвата Завязи',\n    'elements': {\n      'NO3': 238.0,\n      'NH4': 14.0,\n      'P': 39.0,\n      'K': 303.0,\n      'Ca': 200.0,\n      'Mg': 36.0,\n      'S': 56.0,\n      'Cl': 0.0,\n      'Fe': 0.84,\n      'Mn': 0.55,\n      'Zn': 0.33,\n      'B': 0.32,\n      'Cu': 0.06,\n      'Mo': 0.05\n    }\n  },\n  {\n    'name': 'Перец Минвата Конец',\n    'elements': {\n      'NO3': 224.0,\n      'NH4': 14.0,\n      'P': 39.0,\n      'K': 225.0,\n      'Ca': 220.0,\n      'Mg': 36.0,\n      'S': 56.0,\n      'Cl': 0.0,\n      'Fe': 0.84,\n      'Mn': 0.55,\n      'Zn': 0.33,\n      'B': 0.32,\n      'Cu': 0.06,\n      'Mo': 0.05\n    }\n  },\n  {\n    'name': 'Томат Минвата Базовый',\n    'elements': {\n      'NO3': 210.0,\n      'NH4': 17.0,\n      'P': 46.0,\n      'K': 371.0,\n      'Ca': 216.0,\n      'Mg': 58.0,\n      'S': 141.0,\n      'Cl': 35.0,\n      'Fe': 0.84,\n      'Mn': 0.55,\n      'Zn': 0.33,\n      'B': 0.32,\n      'Cu': 0.05,\n      'Mo': 0.05\n    }\n  },\n  {\n    'name': 'Томат Минвата Старт',\n    'elements': {\n      'NO3': 210.0,\n      'NH4': 3.0,\n      'P': 15.0,\n      'K': 371.0,\n      'Ca': 216.0,\n      'Mg': 58.0,\n      'S': 141.0,\n      'Cl': 35.0,\n      'Fe': 0.84,\n      'Mn': 0.55,\n      'Zn': 0.33,\n      'B': 0.32,\n      'Cu': 0.05,\n      'Mo': 0.05\n    }\n  },\n  {\n    'name': 'Томат Минвата Жара',\n    'elements': {\n      'NO3': 210.0,\n      'NH4': 3.0,\n      'P': 46.0,\n      'K': 332.0,\n      'Ca': 236.0,\n      'Mg': 70.0,\n      'S': 141.0,\n      'Cl': 35.0,\n      'Fe': 1.4,\n      'Mn': 0.55,\n      'Zn': 0.33,\n      'B': 0.43,\n      'Cu': 0.05,\n      'Mo': 0.05\n    }\n  },\n  {\n    'name': 'Томат Минвата Завязи',\n    'elements': {\n      'NO3': 210.0,\n      'NH4': 17.0,\n      'P': 46.0,\n      'K': 430.0,\n      'Ca': 196.0,\n      'Mg': 52.0,\n      'S': 141.0,\n      'Cl': 35.0,\n      'Fe': 0.84,\n      'Mn': 0.55,\n      'Zn': 0.33,\n      'B': 0.32,\n      'Cu': 0.05,\n      'Mo': 0.05\n    }\n  },\n  {\n    'name': 'Томат Минвата Конец',\n    'elements': {\n      'NO3': 210.0,\n      'NH4': 17.0,\n      'P': 46.0,\n      'K': 332.0,\n      'Ca': 236.0,\n      'Mg': 58.0,\n      'S': 141.0,\n      'Cl': 35.0,\n      'Fe': 0.84,\n      'Mn': 0.55,\n      'Zn': 0.33,\n      'B': 0.32,\n      'Cu': 0.05,\n      'Mo': 0.05\n    }\n  },\n  {\n    'name': 'Земляника Минвата Базовый',\n    'elements': {\n      'NO3': 168.0,\n      'NH4': 14.0,\n      'P': 31.0,\n      'K': 188.0,\n      'Ca': 144.0,\n      'Mg': 36.0,\n      'S': 48.0,\n      'Cl': 0.0,\n      'Fe': 1.68,\n      'Mn': 0.55,\n      'Zn': 0.46,\n      'B': 0.11,\n      'Cu': 0.05,\n      'Mo': 0.05\n    }\n  },\n  {\n    'name': 'Земляника Минвата Старт',\n    'elements': {\n      'NO3': 193.0,\n      'NH4': 14.0,\n      'P': 39.0,\n      'K': 188.0,\n      'Ca': 184.0,\n      'Mg': 36.0,\n      'S': 48.0,\n      'Cl': 0.0,\n      'Fe': 2.23,\n      'Mn': 0.82,\n      'Zn': 0.46,\n      'B': 0.22,\n      'Cu': 0.05,\n      'Mo': 0.05\n    }\n  },\n  {\n    'name': 'Земляника Минвата Завязи',\n    'elements': {\n      'NO3': 189.0,\n      'NH4': 7.0,\n      'P': 31.0,\n      'K': 266.0,\n      'Ca': 144.0,\n      'Mg': 36.0,\n      'S': 48.0,\n      'Cl': 0.0,\n      'Fe': 1.68,\n      'Mn': 0.55,\n      'Zn': 0.46,\n      'B': 0.11,\n      'Cu': 0.05,\n      'Mo': 0.05\n    }\n  },\n  {\n    'name': 'Огурец Минвата Базовый',\n    'elements': {\n      'NO3': 224.0,\n      'NH4': 18.0,\n      'P': 39.0,\n      'K': 313.0,\n      'Ca': 160.0,\n      'Mg': 33.0,\n      'S': 44.0,\n      'Cl': 0.0,\n      'Fe': 0.84,\n      'Mn': 0.55,\n      'Zn': 0.33,\n      'B': 0.27,\n      'Cu': 0.05,\n      'Mo': 0.05\n    }\n  },\n  {\n    'name': 'Огурец Минвата Старт',\n    'elements': {\n      'NO3': 224.0,\n      'NH4': 4.0,\n      'P': 8.0,\n      'K': 313.0,\n      'Ca': 160.0,\n      'Mg': 33.0,\n      'S': 44.0,\n      'Cl': 0.0,\n      'Fe': 0.84,\n      'Mn': 0.55,\n      'Zn': 0.33,\n      'B': 0.27,\n      'Cu': 0.05,\n      'Mo': 0.05\n    }\n  },\n  {\n    'name': 'Огурец Минвата Жара',\n    'elements': {\n      'NO3': 224.0,\n      'NH4': 11.0,\n      'P': 39.0,\n      'K': 274.0,\n      'Ca': 180.0,\n      'Mg': 39.0,\n      'S': 44.0,\n      'Cl': 0.0,\n      'Fe': 1.4,\n      'Mn': 0.55,\n      'Zn': 0.33,\n      'B': 0.38,\n      'Cu': 0.05,\n      'Mo': 0.05\n    }\n  },\n  {\n    'name': 'Огурец Минвата Завязи',\n    'elements': {\n      'NO3': 238.0,\n      'NH4': 18.0,\n      'P': 39.0,\n      'K': 352.0,\n      'Ca': 160.0,\n      'Mg': 33.0,\n      'S': 44.0,\n      'Cl': 0.0,\n      'Fe': 0.84,\n      'Mn': 0.55,\n      'Zn': 0.33,\n      'B': 0.27,\n      'Cu': 0.05,\n      'Mo': 0.05\n    }\n  },\n  {\n    'name': 'Огурец Минвата Минвата Конец',\n    'elements': {\n      'NO3': 224.0,\n      'NH4': 18.0,\n      'P': 39.0,\n      'K': 274.0,\n      'Ca': 180.0,\n      'Mg': 33.0,\n      'S': 44.0,\n      'Cl': 0.0,\n      'Fe': 0.84,\n      'Mn': 0.55,\n      'Zn': 0.33,\n      'B': 0.27,\n      'Cu': 0.05,\n      'Mo': 0.05\n    }\n  },\n]\n","import {NPKElements} from \"./types\";\nimport {entries, round} from \"../utils\";\nimport {MACRO_ELEMENT_NAMES} from \"./constants\";\nimport {extract_percent} from \"./helpers\";\nimport {calculateEC, convertProfileWithEC} from \"./profile\";\n\n\nexport const ALLOWED_ELEMENT_IN_MATRIX = [\"N\", ...MACRO_ELEMENT_NAMES]\nexport type ALLOWED_ELEMENT_IN_MATRIX = typeof ALLOWED_ELEMENT_IN_MATRIX[number]\ntype ElementInMatrix<T = number> = {\n  [K in ALLOWED_ELEMENT_IN_MATRIX]: T\n}\n\nexport interface ElementsMatrixType extends ElementInMatrix<ElementInMatrix> {\n  //  ElementsMatrixType.N.K must be equal N / K\n}\n\n/**\n * Расчет матрицы соотношений\n * @param npk\n * @return ElementsMatrixType\n */\nexport function getProfileRatioMatrix(npk: NPKElements): ElementsMatrixType {\n  let elMap: ElementInMatrix = {}\n  for (let [El, ppm] of entries(npk)) {\n    if (ALLOWED_ELEMENT_IN_MATRIX.includes(El)) {\n      elMap[El] = ppm\n    }\n  }\n  elMap.N = (npk.NH4 || 0) + (npk.NO3 || 0)\n  return Object.fromEntries(entries(elMap).map(\n      ([el, ppm]) =>\n        [el, Object.fromEntries(entries(elMap).map(\n            ([el2, ppm2]) => {\n              let r = 1;\n              if (el !== el2) {\n                if (ppm2 === 0) {\n                  r = 0\n                } else {\n                  r = round(ppm / ppm2, 3)\n                  if (!isFinite(r)) {\n                    r = 0\n                  }\n                }\n              }\n              return [el2, r]\n            }\n          )\n        )]\n    )\n  )\n}\n\ntype PartialElementsMatrix = {\n  [K in keyof ElementInMatrix]?: ElementInMatrix\n}\n\n/**\n * Конвертирование npk используя матрицу соотношений\n * Смысл в том чтобы корректировать npk рецепта по соотношениям отдельных элементов K:N, K:Mg и тд\n * Подробнее https://github.com/WEGA-project/WEGA-HPG/wiki#general-ppm\n * @param npk\n * @param ratio\n */\nexport function convertProfileWithRatio(\n  npk: NPKElements,\n  ratio: PartialElementsMatrix): NPKElements {\n  const EC = calculateEC(npk)\n  const v = getProfileRatioMatrix(npk)\n\n  let newNPK: NPKElements = {...npk}\n  for (let [el1, toEls] of entries(ratio)) {\n    for (let [el2, r] of entries(toEls)) {\n      if (el1 === el2) {\n        continue\n      }\n      let f = (v: number, r: number) => v * r\n      v[el1][el2] = r\n      if (el1 === \"N\") {\n        let _N = f((newNPK[el2 as MACRO_ELEMENT_NAMES] || 0), r)\n        newNPK.NH4 = extract_percent(_N, v.NH4.NO3)\n        newNPK.NO3 = _N - newNPK.NH4\n      } else {\n        let elM = newNPK[el2 as MACRO_ELEMENT_NAMES] || 0\n        if (el2 === 'N') {\n          elM = (newNPK.NO3 || 0) + (newNPK.NH4 || 0)\n        }\n        newNPK[el1 as MACRO_ELEMENT_NAMES] = elM * r\n      }\n    }\n  }\n\n  newNPK = convertProfileWithEC(newNPK, EC, v)\n  return Object.fromEntries(entries(newNPK)\n    .map(([el, v]) => (\n      [el, round(v, 1)]\n    )))\n}\n\n\nexport interface MultiElementRatio {\n  elements: ALLOWED_ELEMENT_IN_MATRIX[],\n  ratio: number[],\n  matrix: Partial<ElementInMatrix>,\n  display: string,\n}\n/**\n *\n * @param npk is NPKElements\n * @param elements is array of elements name, ['K', 'Ca', 'Mg']\n * @return MultiElementRatio, example:\n * ```js\n * {\n *  elements: ['K', 'Ca', 'Mg'],\n *  ratio: [5, 3, 1],\n *  matrix: {'K': 5, 'Ca': 3, 'Mg': 1}\n * }\n * ```\n */\nexport function getMultiElementRatio(npk: NPKElements, elements: ALLOWED_ELEMENT_IN_MATRIX[]): MultiElementRatio {\n  const ratio = getMultiRatio(elements.map(e => {\n    if (e === \"N\") {\n      return (npk.NO3 || 0) + (npk.NH4 || 0)\n    }\n    return npk[e as MACRO_ELEMENT_NAMES] || 0\n  }))\n\n  return {\n    elements,\n    ratio,\n    matrix: Object.fromEntries(elements.map((e, i) => [e, ratio[i]])),\n    display: ratio.map(s => s.toString()).join(\":\")\n\n  }\n}\n\n/**\n *\n * @param arr is number[] [80, 180, 40]\n * @return number[] [2,4.5,1]\n */\nexport function getMultiRatio(arr: number[]): number[] {\n  const base = Math.min(...arr)\n  const baseIndex = arr.indexOf(base)\n  return arr.map((n, i) => {\n    if (baseIndex === i) {\n      return 1\n    }\n    return round(n / base, 1)\n  })\n}\n\n/**\n * Пересчет значений к новому соотношению\n * @param arr [50, 50, 50]\n * @param ratio [2, 4, 1]\n * @returns number[]. example [100, 200, 50]\n */\nexport function calculateByMultiRatio(arr: number[], ratio: number[]): number[] {\n  if (arr.length !== ratio.length) {\n    throw new Error(\"array size must be equal!\")\n  }\n  const base = Math.min(...ratio)\n  const baseIndex = ratio.indexOf(base)\n  const basePart = arr[baseIndex] / base\n  return ratio.map(n => n * basePart)\n}\n\nexport const OPTIMAL_RATIO: { [key: string]: number[] } = {\n  'K:N': [1.5, 2.5],\n  'N:Ca': [1.0, 2.0],\n  'K:Ca': [2.0, 3.0],\n  'K:Mg': [3.0, 5.0],\n  'Ca:Mg': [4.0, 6.0],\n  \"NH4:NO3\": [5, 20],\n  \"P\": [30, 60],\n  \"EC\": [1.2, 3.5],\n  \"B\": [200, 500],\n  \"Cl\": [0, 20]\n}","import React, {forwardRef, useEffect, useState} from \"react\";\nimport {Box, BoxProps} from \"rebass\";\nimport {EmotionIcon} from '@emotion-icons/emotion-icon'\n\nimport {useTheme} from \"emotion-theming\";\nimport {Theme} from \"@/themes/types\";\n\n\ninterface IconProps extends Omit<BoxProps, keyof HTMLDivElement | 'css'> {\n  component: EmotionIcon,\n  disabled?: boolean,\n  size?: number | string\n}\n\nexport const Icon = forwardRef<HTMLDivElement, IconProps>(\n  (props, buttonRef) => {\n    const {\n      component: IconComponent,\n      size = \"1.5em\",\n      children,\n      ...extraProps\n    } = props\n    const [containerSize, setSize] = useState<number | string>(size || 0)\n    const theme = useTheme<Theme>()\n\n    useEffect(() => {\n      if (!size && buttonRef && 'current' in buttonRef) {\n        setSize(buttonRef.current?.offsetWidth || 0)\n      }\n    }, [buttonRef, setSize, size])\n\n    return (\n      <Box {...extraProps} ref={buttonRef}>\n        <IconComponent\n          color={theme.colors?.text}\n          size={containerSize}\n        />\n      </Box>\n    )\n  })\n"],"sourceRoot":""}